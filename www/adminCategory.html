<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta id="viewport" name="viewport" content="width=320; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="apple-touch-fullscreen" content="yes" />

    <script type="text/javascript" src="xml2json.js"></script>
    <script type="text/javascript" src="kpos.js"></script>
    <script type="text/javascript" src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js"></script>
    
    <link rel="stylesheet" href="example.css" TYPE="text/css" MEDIA="screen">
    
    <style type="text/css">
        body{
            font-size:14px;
            background:#c4f0f1;
            text-align:center;
        }

        .tableone {width:250px; border-collapse:collapse; margin:0 auto;}
        .tabletwo {width:220px; margin:2px; border:1px solid #B3B1B1; border-spacing: 1px; border-style:outset}

        .th1 {width:149px;}
        .th2 {width:99px;}
        .th3 {width:99px;}
        .th4 {width:99px;}
        .th5 {width:200px;}

        .td1 {width:149px;border:1px solid #B3B1B1;}
        .td2 {width:99px;}
        .td3 {width:99px;}
        .td4 {width:99px;}
        .td5 {width:170px;}

        .tableone {background:#697210; border:1px solid #fff; color:#fff;}
        .tableone td {border:1px solid #fff; color:#fff;}
        .tableone tbody {background:#eee; color:#000;}
        .tableone caption {background:#fff; color:#697210; font-size:1.2em; margin:0 auto;}
        .tableone th, .tabletwo th {text-align:left;}

        .tabletwo td {background:#eee; color:#000;}
        .tabletwo tr.dk th {background:#ddd; color:#000;}
        .tabletwo tr.dk td {background:#ddd; color:#000;}

        .innerb {height:30em; overflow:auto;}
    </style>
    <script type="text/javascript">
		/* Optional: Temporarily hide the "tabber" class so it does not "flash"
		   on the page as plain HTML. After tabber runs, the class is changed
		   to "tabberlive" and it will appear.
		*/
		document.write('<style type="text/css">.tabber{display:none;}<\/style>');
		
		var tabberOptions = {
		
		  /* Optional: instead of letting tabber run during the onload event,
		     we'll start it up manually. This can be useful because the onload
		     even runs after all the images have finished loading, and we can
		     run tabber at the bottom of our page to start it up faster. See the
		     bottom of this page for more info. Note: this variable must be set
		     BEFORE you include tabber.js.
		  */
		  'manualStartup':true,
		
		  /* Optional: code to run after each tabber object has initialized */
		
		  'onLoad': function(argsObj) {
		    /* Display an alert only after tab2 */
		    if (argsObj.tabber.id == 'tab2') {
		      alert('Finished loading tab2!');
		    }
		  },
		
		  /* Optional: code to run when the user clicks a tab. If this
		     function returns boolean false then the tab will not be changed
		     (the click is canceled). If you do not return a value or return
		     something that is not boolean false, */
		
		  'onClick': function(argsObj) {
		
		    var t = argsObj.tabber; /* Tabber object */
		    var id = t.id; /* ID of the main tabber DIV */
		    var i = argsObj.index; /* Which tab was clicked (0 is the first tab) */
		    var e = argsObj.event; /* Event object */
		
		    if (id == 'tab2') {
		      return confirm('Swtich to '+t.tabs[i].headingText+'?\nEvent type: '+e.type);
		    }
		  },
		
		  /* Optional: set an ID for each tab navigation link */
		  'addLinkId': true
		
		};
	</script>

	<!-- Load the tabber code -->
	<script type="text/javascript" src="tabber.js"></script>
	<script language="javascript">
	    var currentRow=-1;
	
		var ADD = "ADD";
		var UPDATE = "UPDATE";
		
	    var v_selected_cat_rowid = "";
	    
	    var curr_category = localStorage.getItem('curr_category');
	    
		var operation = "";
		
		var deletedRowId = "";
		
		function setCurrentCategory(category) {
			curr_category = category;
			var jsonString = obj2str(curr_category);
			localStorage.setItem('curr_category', jsonString);
		}
		function getCurrentCategory() {
			curr_category = strToObj(localStorage.getItem('curr_category'));
			return curr_category;
		}
		function getCategories() {
			var categories = strToObj(localStorage.getItem('v_categories'));
			if(categories == null || categories.length == undefined) {
				var category_array = new Array();
				category_array.push(categories);
				return category_array;
			}
			return categories;
		}
		function setCategories(categories) {
			var jsonString = obj2str(categories);
			localStorage.setItem('v_categories', jsonString);
		}
	    
		function uncheckPrinters(printers) {
			for(var n = 0; n < printers.length; n++) {
				printers[n].checked = false;
			}
		}
		function checkPrinters(printers, pId) {
			for(var n = 0; n < printers.length; n++) {
				if(printers[n].value == pId) {
					printers[n].checked = true;
				}
			}
		}
	    function selectRow(tableID, selectedRowID) {
	        var table = document.getElementById(tableID);
	        v_selected_cat_rowid = selectedRowID;
	        var rowCount = table.rows.length;
	        operation = UPDATE;
	        for(var i = 0; i < rowCount; i++) {
	            var row = table.rows[i];
	            if(row.id == selectedRowID) {
	                row.style.background = '#dcfac9';
	                row.cells[0].style.background = '#dcfac9';
	                row.cells[1].style.background = '#dcfac9';
	                currentRow = i;
	                
	                var v_categories = getCategories();
	                if(v_categories.length != undefined) {
	                	setCurrentCategory(v_categories[i]);
	                } else {
	                	setCurrentCategory(v_categories);
	                }
	                if(curr_category != null) {
	                	document.getElementById("categoryName").value = curr_category.name;
	        			document.getElementById("categoryNotes").value = curr_category.notes;
	        			document.getElementById("catThumb").value = curr_category.thumb;
	        			document.getElementById("categoryImg").src = curr_category.thumb;
	        			document.getElementById("categoryName").readOnly = false;
	        			document.getElementById("categoryNotes").readOnly = false;
	        			document.getElementById("catThumb2").disabled = false;
	        			//Set selected pritners
	        			var printers = document.getElementsByName("catPrinters");
	        			uncheckPrinters(printers);
	        			var printerIds = curr_category.printerids;
	        			if(printerIds != null) {
	        				if(printerIds.length != undefined) {
		        				for(var m = 0; m < printerIds.length; m++) {
		        					var pId = printerIds[m];
		        					checkPrinters(printers, pId);
		        				}
		        			} else {
		        				checkPrinters(printers, printerIds);
		        			}
	        			}
	        			
	        			listSaleItemsForCat(curr_category.id);
	        			listCatOptions(curr_category.id);
	        		}
	        		document.getElementById("btnNewItem").disabled = false;
	            } else {
	                row.style.background = ''; //'#f0c992';
	                row.cells[0].style.background = ''; //'#f0c992';
	                row.cells[1].style.background = ''; //'#f0c992';
	            }
	        }
	    }
	    function addCategoryRow(tableID, categoryObj, selectRowFunc, deleteRowFunc) {
	        var table = document.getElementById(tableID);
	
	        var rowCount = table.rows.length;
	        var rowId = tableID + "_r" + rowCount;
	        
	        var row = table.insertRow(rowCount);	
	       	row.id = rowId;
	        row.name = rowId;
	       	
	       	var innerHTML = "<td onclick='"+selectRowFunc+"(\""+tableID+"\", \""+rowId+"\");'>"+categoryObj.name+"</td><td><a href='javascript:"+deleteRowFunc+"(\""+tableID+"\",\""+rowId+"\","+categoryObj.id+");'>X</a></td>";
	       	row.innerHTML = innerHTML;
	       	row.onmouseover = function(){ highlightRow(this, true); };
	        row.onmouseout = function(){ highlightRow(this, false); };
	    }
	    function deleteCategoryRow(tableId, rowID, catId) {
	    	var deleteCategoryType = new DeleteCategoryType(catId);
            call_web_service(deleteCategoryType, deleteCategoryHandler);
	    }
	    function deleteCategoryHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
                jsonObj.deletecategoryresponsetype != undefined && jsonObj.deletecategoryresponsetype != null &&
                jsonObj.deletecategoryresponsetype.result.successful == "true") {
                listAllCategories();
            } else {
            	alert("failed to delete category!");
            }
            deletedRowId = "";
		}
	    function saveCategoryInfo() {
	    	if(operation == ADD){
	    		createCategory();
	    	} else if(operation == UPDATE) {
	    		updateCategory();
	    	}
	    }
	    function newCategory() {
	    	document.getElementById("categoryName").value = "";
	      	document.getElementById("categoryName").readOnly = false;
	        document.getElementById("categoryNotes").value = "";
	        document.getElementById("categoryNotes").readOnly = false;
	        document.getElementById("catThumb2").disabled = false;
	        document.getElementById("categoryImg").src = "";
	        var printers = document.getElementsByName("catPrinters");
	        uncheckPrinters(printers);
	        operation = ADD;
	        setCurrentCategory(null);
	    }
	    
	    function getPrinterIds(name) {
	    	var printers = document.getElementsByName(name);
			var printerIds = new Array();
			if(printers != null) {
				for(var i = 0; i < printers.length; i++) {
					if(printers[i].checked) {
						printerIds.push(printers[i].value);
					}
				}
			}
			return printerIds;
	    }
	    function createCategory() {
	        var name = document.getElementById("categoryName").value;
	        var thumb = document.getElementById("categoryImg").src;
	        var notes = document.getElementById("categoryNotes").value;
	        var catPrinterIds = getPrinterIds("catPrinters");
			
	        var categoryType = new CreateCategoryType(name, notes, thumb, catPrinterIds);
	        ws_create_category(categoryType, addCategoryHandler);
	    }
	    function addCategoryHandler(jsonObj) {
	        if(jsonObj != undefined && jsonObj != null &&
	            jsonObj.createcategoryresponsetype != undefined && jsonObj.createcategoryresponsetype != null &&
	            jsonObj.createcategoryresponsetype.result.successful == "true") {
	           	listAllCategories();
	        } else {
	            alert("failed to add category!");
	        }
	        operation = "";
	    }
		function updateCategory() {
			var name = document.getElementById("categoryName").value;
	        var thumb = document.getElementById("categoryImg").src;
	        var notes = document.getElementById("categoryNotes").value;
	        var catPrinterIds = getPrinterIds("catPrinters");
	        curr_category.name = name;
	        curr_category.thumb = thumb;
	        curr_category.notes = notes;
	        curr_category.printerids = catPrinterIds;
	        setCurrentCategory(curr_category);
	        
	        var categoryType = new UpdateCategoryType(curr_category.id, name, notes, thumb, catPrinterIds);
	        ws_update_category(categoryType, updateCategoryHandler);
		}
		function updateCategoryHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
	            jsonObj.updatecategoryresponsetype != undefined && jsonObj.updatecategoryresponsetype != null &&
	            jsonObj.updatecategoryresponsetype.result.successful == "true") {
	            var selectedRow = document.getElementById(v_selected_cat_rowid);
                if(selectedRow != null && selectedRow.cells != null) {
                	selectedRow.cells[0].innerText = document.getElementById("categoryName").value;
                	var categories = getCategories();
            		for(var i = 0; i < categories.length; i++) {
            			if(categories[i].id == curr_category.id) {
            				categories[i] = curr_category;
            				setCategories(categories);
            				break;
            			}
            		}
                }
                alert("Save successful!");
	        } else {
	            alert("Failed to update category!");
	        }
	        operation = "";
		}
		function setPrintersHTML(id, handler) {
			var listPrintersHTMLType = new ListPrintersHTMLType(id);
			ws_list_printer_html(listPrintersHTMLType, handler);
		}
		function setPrintersHTMLHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listprintershtmlresponsetype != undefined && jsonObj.listprintershtmlresponsetype != null && 
				jsonObj.listprintershtmlresponsetype.result.successful == "true") {
				html = jsonObj.listprintershtmlresponsetype.html;
				var temp = unescape(html); 				
				//alert(temp);
				temp = html.replace(/&lt;/g, "<");
				temp = temp.replace(/&gt;/g, ">");
				//alert(temp);
				document.getElementById("catPrinterCell").innerHTML = temp;
			}
		}
		
		function listAllCategories(){
			ws_list_categories(listAllCategoriesHandler);
		}
		function listAllCategoriesHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listcategoryresponsetype != undefined && jsonObj.listcategoryresponsetype != null &&
				jsonObj.listcategoryresponsetype.result.successful == 'true') {
				//Clear the table
				document.getElementById("category").innerHTML = "";
				var categories = jsonObj.listcategoryresponsetype.categories;
				var count = jsonObj.listcategoryresponsetype.total;
                setCategories(categories);
                if(categories != undefined && categories != null) {
	                if(count > 1) {
	                	for(var i = 0; i < categories.length; i++) {
	                		addCategoryRow("category", categories[i], "selectRow", "deleteCategoryRow");
	                	}
	                } else if(count == 1){
	                	//Only one category
	                	addCategoryRow("category", categories, "selectRow", "deleteCategoryRow");
	                }
	            }
			}
		}
		
		function updatePicture(id, src) {
			document.getElementById(id).src = src;
		}
	</script>
	<script language="javascript">
		var currentItemRow = -1;
	
	    var v_selected_item_rowid = "";
	    
	    var curr_item = localStorage.getItem('curr_item');
	    
		var itemOperation = "";
		var optionOperation = "";
		
		var deletedItemRowId = "";
		
		function setCurrentItem(item) {
			curr_item = item;
			var jsonString = "null";
			if(curr_item != null) {
				jsonString = obj2str(curr_item);
			}
			localStorage.setItem('curr_item', jsonString);
		}
		function getCurrentItem() {
			curr_item = strToObj(localStorage.getItem('curr_item'));
			return curr_item;
		}
		function getItems() {
			var items = strToObj(localStorage.getItem('v_items'));
			if(items == null || items.length == undefined) {
				var item_array = new Array();
				item_array.push(items);
				return item_array;
			}
			return items;
		}
		function setItems(items) {
			var jsonString = obj2str(items);
			localStorage.setItem('v_items', jsonString);
		}
		function enableDineInSizes(isEnabled) {
			document.getElementById("smallPrice").disabled = !isEnabled;
			document.getElementById("mediumPrice").disabled = !isEnabled;
			document.getElementById("largePrice").disabled = !isEnabled;
		}
		function enableTakeoutSizes(isEnabled) {
			document.getElementById("smallOutPrice").disabled = !isEnabled;
			document.getElementById("mediumOutPrice").disabled = !isEnabled;
			document.getElementById("largeOutPrice").disabled = !isEnabled;
		}
		function enableSeasonalPrice() {
			var isChecked = document.getElementById("seasonPrice").checked;
			document.getElementById("hasDineInSizes").disabled = isChecked;
	        document.getElementById("hasTakeOutSizes").disabled = isChecked;
	        enableDineInSizes(!isChecked);
	        enableTakeoutSizes(!isChecked);
	        document.getElementById("defaultItemPrice").disabled = isChecked;
	        document.getElementById("defaultItemOutPrice").disabled = isChecked;
		}
		function addItemRow(tableID, itemObj, selectRowFunc, deleteRowFunc) {
	        var table = document.getElementById(tableID);
	
	        var rowCount = table.rows.length;
	        var rowId = tableID + "_r" + rowCount;
			
			var row = table.insertRow(rowCount);
			row.id = rowId;
	       	//var innerHTML = "<tr id='"+rowId+"' onmouseover='javascript:highlightRow(this, true);' onmouseout=''javascript:highlightRow(this, false);>";
	       	var innerHTML = "<td onclick='"+selectRowFunc+"(\""+tableID+"\", \""+rowId+"\","+itemObj.id+");'>"+itemObj.name+"</td><td><a href='javascript:"+deleteRowFunc+"(\""+tableID+"\",\""+rowId+"\","+itemObj.id+");'>X</a></td>";//</tr></tbody>
	       	row.innerHTML = innerHTML;
	       	row.onmouseover = function(){ highlightRow(this, true); };
	        row.onmouseout = function(){ highlightRow(this, false); };
	    }
		function selectItemRow(tableId, rowId, itemId) {
			alert(itemId);
			if(itemId != null && itemId != "") {
				var soapType = new FetchSaleItemType(itemId);
				call_web_service(soapType, fetchSaleItemHandler);
			}
		}
		function fetchSaleItemHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
                jsonObj.fetchsaleitemresponsetype != undefined && jsonObj.fetchsaleitemresponsetype != null &&
                jsonObj.fetchsaleitemresponsetype.result.successful == "true") {
                var item = jsonObj.fetchsaleitemresponsetype.saleitem;
               	document.forms[0].itemName.value = item.name;
               	document.forms[0].itemDescription.value = item.description==null?"":item.description;
               	document.forms[0].defaultItemPrice.value = item.normalprice==null?"":item.normalprice;
               	document.forms[0].defaultItemOutPrice.value = item.takeoutprice==null?"":item.takeoutprice;
               	document.forms[0].itemImg.src = item.thumpath==null?"":item.thumbpath;
               	document.forms[0].itemTaxable.checked = item.istaxable=="true";
               	document.forms[0].singleOption.checked = item.issingleoption=="true";
               	document.forms[0].hasSeasonPrice.checked = item.seasonprice!=null && item.seasonprice>0;
               	document.forms[0].seasonPrice.vaue = item.seasonprice;
               	document.forms[0].smallPrice.value = item.pricesmall;
				document.forms[0].mediumPrice.value = item.pricemed;
				document.forms[0].largePrice.value = item.pricelarge;
				document.forms[0].smallOutPrice.value = item.outpricesmall;
				document.forms[0].mediumOutPrice.value = item.outpricemedium;
				document.forms[0].largeOutPrice.value = item.outpricelarge;
				document.forms[0].hasDineInSizes.checked = item.pricesmall!=null||item.pricemed!=null||item.pricelarge!=null;
	        	document.forms[0].hasTakeOutSizes.checked = item.outpricesmall!=null||item.outpricemedium!=null||item.outpricelarge!=null;
	        	
				var printerIds = item.printerids;
				var printers = document.getElementsByName("itemPrinters");
	        	uncheckPrinters(printers);
				if(printerIds != null) {
					if(printerIds.length != undefined) {
						for(var m = 0; m < printerIds.length; m++) {
							var pId = printerIds[m];
							checkPrinters(printers, pId);
						}
					} else {
						checkPrinters(printers, printerIds);
					}
				}
				document.forms[0].itemId.value = item.id;
				itemOperation = UPDATE;
            }
		}
	    function deleteItemRow(tableId, rowID, itemId) {
	    	if(itemId != null && itemId != "") {
	    		var deleteItemType = new DeleteSaleItemType(itemId);
				call_web_service(deleteItemType, deleteItemHandler);
			}
	    }
	    function deleteItemHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
                jsonObj.deletesaleitemresponsetype != undefined && jsonObj.deletesaleitemresponsetype != null &&
                jsonObj.deletesaleitemresponsetype.result.successful == "true") {
                var category = getCurrentCategory();
                if(category != null) {
                	listSaleItemsForCat(category.id);
                	resetItem();
                }
            } else {
            	alert("failed to delete category!");
            }
            deletedItemRowId = "";
		}
		function resetItem() {
			document.forms[0].itemName.value = "";
	      	document.forms[0].itemDescription.value = "";
	        document.forms[0].defaultItemPrice.value = "";
	        document.forms[0].defaultItemOutPrice.value = "";
	        document.forms[0].itemImg.src = "";
	        document.forms[0].hasDineInSizes.checked = false;
	        document.forms[0].hasTakeOutSizes.checked = false;
	        document.forms[0].itemTaxable.checked = false;
	        document.forms[0].singleOption.checked = false;
	        document.forms[0].hasSeasonPrice.checked = false;
	        document.forms[0].seasonPrice.vaue = "";
			document.forms[0].smallPrice.value = "";
			document.forms[0].mediumPrice.value = "";
			document.forms[0].largePrice.value = "";
			document.forms[0].smallOutPrice.value = "";
			document.forms[0].mediumOutPrice.value = "";
			document.forms[0].largeOutPrice.value = "";
			
	        var printers = document.getElementsByName("itemPrinters");
	        uncheckPrinters(printers);
	        itemOperation = "";
	        setCurrentItem(null);
	        document.forms[0].itemId.value = "";
		}
		function newItem() {
	    	resetItem();
	        itemOperation = ADD;
	    }
	    function setItemPrintersHTMLHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listprintershtmlresponsetype != undefined && jsonObj.listprintershtmlresponsetype != null && 
				jsonObj.listprintershtmlresponsetype.result.successful == "true") {
				html = jsonObj.listprintershtmlresponsetype.html;
				var temp = unescape(html); 				
				//alert(temp);
				temp = html.replace(/&lt;/g, "<");
				temp = temp.replace(/&gt;/g, ">");
				document.getElementById("itemPrinterCell").innerHTML = temp;
			}
		}
		function saveItemInfo() {
			if(itemOperation == ADD){
	    		createSaleItem();
	    	} else if(itemOperation == UPDATE) {
	    		updateSaleItem();
	    	}
		}
		function createSaleItem() {
			if(curr_category != null && document.forms[0].itemId.value=="") {
				var catId = curr_category.id;
				
				var name = document.getElementById("itemName").value;
				var taxable = document.getElementById("itemTaxable").checked;
				var isSingleOption = document.getElementById("singleOption").checked;
				var description = document.getElementById("itemDescription").value;
				
				var defaultPrice = document.getElementById("defaultItemPrice").value;
				
				var hasSeasonPrice = document.getElementById("hasSeasonPrice").checked;
				var seasonPrice = hasSeasonPrice == true ? document.getElementById("seasonPrice").value : null;
				
				var defaultOutPrice = hasSeasonPrice == true ? null:document.getElementById("defaultItemOutPrice").value;
				var smallPrice = null, mediumPrice = null, largePrice = null;
				var smallOut = null, mediumOut = null, largeOut = null;
				
				var hasDineInSizes = document.getElementById("hasDineInSizes").checked;
				var hasTakeoutSizes = document.getElementById("hasTakeOutSizes").checked;
				if(!hasSeasonPrice) {
					if(hasDineInSizes) {
						smallPrice = document.getElementById("smallPrice").value;
						mediumPrice = document.getElementById("mediumPrice").value;
						largePrice = document.getElementById("largePrice").value;
					}
					if(hasTakeoutSizes) {
						smallOut = document.getElementById("smallOutPrice").value;
						mediumOut = document.getElementById("mediumOutPrice").value;
						largeOut = document.getElementById("largeOutPrice").value;
					}
				}
				
				var thumb = document.getElementById("itemImg").src;
				var printerIds = getPrinterIds("itemPrinterCell");
				
				var createItemType = new CreateItemType(catId,name,description,thumb,printerIds,isSingleOption,defaultPrice,defaultOutPrice,taxable,smallPrice,mediumPrice,largePrice,smallOut,mediumOut,largeOut,seasonPrice);
				ws_create_item(createItemType, createSaleItemHandler);
			}
		}
		function createSaleItemHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.createsaleitemresponsetype != undefined && jsonObj.createsaleitemresponsetype != null && 
				jsonObj.createsaleitemresponsetype.result.successful == "true") {
				var itemId = jsonObj.createsaleitemresponsetype.result.id;
				//document.forms[0].itemId.value = itemId;
				var category = getCurrentCategory();
                if(category != null) {
                	listSaleItemsForCat(category.id);
                	resetItem();
                }
			} else {
	            alert("failed to add sale item!");
	        }
	        itemOperation = "";
		}
		function updateSaleItem() {
			if(curr_category != null && document.forms[0].itemId.value != "" && document.forms[0].itemId.value != null) {
				var catId = curr_category.id;
				var itemId = document.forms[0].itemId.value;
				var name = document.getElementById("itemName").value;
				var taxable = document.getElementById("itemTaxable").checked;
				var isSingleOption = document.getElementById("singleOption").checked;
				var description = document.getElementById("itemDescription").value;
				
				var defaultPrice = document.getElementById("defaultItemPrice").value;
				
				var hasSeasonPrice = document.getElementById("hasSeasonPrice").checked;
				var seasonPrice = hasSeasonPrice == true ? document.getElementById("seasonPrice").value : null;
				
				var defaultOutPrice = hasSeasonPrice == true ? null:document.getElementById("defaultItemOutPrice").value;
				var smallPrice = null, mediumPrice = null, largePrice = null;
				var smallOut = null, mediumOut = null, largeOut = null;
				
				var hasDineInSizes = document.getElementById("hasDineInSizes").checked;
				var hasTakeoutSizes = document.getElementById("hasTakeOutSizes").checked;
				if(!hasSeasonPrice) {
					if(hasDineInSizes) {
						smallPrice = document.getElementById("smallPrice").value;
						mediumPrice = document.getElementById("mediumPrice").value;
						largePrice = document.getElementById("largePrice").value;
					}
					if(hasTakeoutSizes) {
						smallOut = document.getElementById("smallOutPrice").value;
						mediumOut = document.getElementById("mediumOutPrice").value;
						largeOut = document.getElementById("largeOutPrice").value;
					}
				}
				
				var thumb = document.getElementById("itemImg").src;
				var printerIds = getPrinterIds("itemPrinterCell");
				
				var updateItemType = new UpdateItemType(itemId, catId,name,description,thumb,printerIds,isSingleOption,defaultPrice,defaultOutPrice,taxable,smallPrice,mediumPrice,largePrice,smallOut,mediumOut,largeOut,seasonPrice);
				call_web_service(updateItemType, updateSaleItemHandler);
			}
		}
		function updateSaleItemHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.updatesaleitemresponsetype != undefined && jsonObj.updatesaleitemresponsetype != null && 
				jsonObj.updatesaleitemresponsetype.result.successful == "true") {
				alert("Save successful!");
			} else {
				alert("Failed to save item!");
			}
		}
		function listSaleItemsForCat(catId) {
			if(catId != null && catId != "") {
				var listType = new ListSaleItemsForCategoryType(catId);
				call_web_service(listType, listSaleItemsForCatHandler);
			} else {
				alert("Please select a category.");
			}
		}
		function listSaleItemsForCatHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listsaleitemsforcategoryresponsetype != undefined && jsonObj.listsaleitemsforcategoryresponsetype != null && 
				jsonObj.listsaleitemsforcategoryresponsetype.result.successful == "true") {
				document.getElementById("menuItem").innerHTML = ""; //clear the table
				var items = jsonObj.listsaleitemsforcategoryresponsetype.saleitems;
				var count = jsonObj.listsaleitemsforcategoryresponsetype.total;
				setItems(items);
				if(items != undefined && items != null) {
	                if(count > 1) {
						for(var i = 0; i < count; i++) {
							addItemRow("menuItem", items[i], "selectItemRow", "deleteItemRow");
						}
					} else if(count == 1){
						addItemRow("menuItem", items, "selectItemRow", "deleteItemRow");
					}						
				}
				resetItem();
			}
		}
	</script>
	<script>
		function resetCatOption() {
			document.optionDetails.catOptionId.value = "";
			document.optionDetails.catOptionName.value = "";
			document.optionDetails.catOptionDescription.value = "";
			document.optionDetails.catOptionPrice.value = "";
			document.optionDetails.catOptionOutPrice.value = "";
			document.optionDetails.catOptionThumb2.value = "";
			document.optionDetails.catOptionImg.src = "";
		}
		function newCatOption() {
	    	resetCatOption();
	        optionOperation = ADD;
	    }
	    function saveCatOptionInfo() {
	    	if(optionOperation == ADD){
	    		createCatOption();
	    	} else if(optionOperation == UPDATE) {
	    		updateCatOption();
	    	}
	    }
	    function createCatOption() {
	    	if(curr_category != null && document.optionDetails.catOptionId.value=="") {
				var catId = curr_category.id;
				var name = document.optionDetails.catOptionName.value;
				var desc = document.optionDetails.catOptionDescription.value;
				var price = document.optionDetails.catOptionPrice.value;
				var outPrice = document.optionDetails.catOptionOutPrice.value;
				var thumb = document.optionDetails.catOptionImg.src;
				var taxable = document.optionDetails.catOptionTaxable.checked;
				var soapType = new CreateCategoryOptionType(catId, name, desc, price, thumb, taxable);
				call_web_service(soapType, createCatOptionHandler);
			}
	    }
	    function createCatOptionHandler(jsonObj) {
	    	if(jsonObj != undefined && jsonObj != null &&
				jsonObj.createcategoryoptionresponsetype != undefined && jsonObj.createcategoryoptionresponsetype != null && 
				jsonObj.createcategoryoptionresponsetype.result.successful == "true") {
				document.optionDetails.catOptionId.value = jsonObj.createcategoryoptionresponsetype.optionid;
				listCatOptions(curr_category.id);
			}
	    }
	    function updateCatOption() {
	    	if(curr_category != null && document.optionDetails.catOptionId.value!=null && document.optionDetails.catOptionId.value!="") {
	    		var id = document.optionDetails.catOptionId.value;
				var catId = curr_category.id;
				var name = document.optionDetails.catOptionName.value;
				var desc = document.optionDetails.catOptionDescription.value;
				var price = document.optionDetails.catOptionPrice.value;
				var outPrice = document.optionDetails.catOptionOutPrice.value;
				var thumb = document.optionDetails.catOptionImg.src;
				var taxable = document.optionDetails.catOptionTaxable.checked;
				var soapType = new UpdateCategoryOptionType(id, catId, name, desc, price, thumb, taxable);
				call_web_service(soapType, updateCatOptionHandler);
			}
	    }
	    function updateCatOptionHandler(jsonObj) {
	    	if(jsonObj != undefined && jsonObj != null &&
				jsonObj.updatecategoryoptionresponsetype != undefined && jsonObj.updatecategoryoptionresponsetype != null && 
				jsonObj.updatecategoryoptionresponsetype.result.successful == "true") {
				alert("Save successful!");
			} else {
				alert("Failed to update option!");
			}
	    }
	    function fetchCatOption(id) {
	    	if(id != null && id != "") {
	    		var soapType = new FetchCategoryOptionType(id);
	    		call_web_service(soapType, fetchCatOptionHandler);
	    	}
	    }
	    function fetchCatOptionHandler(jsonObj) {
	    	if(jsonObj != undefined && jsonObj != null &&
				jsonObj.fetchcategoryoptionresponsetype != undefined && jsonObj.fetchcategoryoptionresponsetype != null && 
				jsonObj.fetchcategoryoptionresponsetype.result.successful == "true") {
				var option = jsonObj.fetchcategoryoptionresponsetype.option;
				document.optionDetails.catOptionId.value = option.id;
				document.optionDetails.catOptionName.value = option.name;
				document.optionDetails.catOptionDescription.value = option.description;
				document.optionDetails.catOptionPrice.value = option.price;
				document.optionDetails.catOptionImg.src = option.thumb;
				document.optionDetails.catOptionTaxable.checked = (option.taxable=="true");
				optionOperation = UPDATE;
			}
	    }
	    function deleteCatOption(id) {
	    	if(id != null && id != "") {
	    		var soapType = new DeleteCategoryOptionType(id);
	    		call_web_service(soapType, deleteCatOptionHandler);
	    	}
	    }
	    function deleteCatOptionHandler(jsonObj) {
	    	if(jsonObj != undefined && jsonObj != null &&
                jsonObj.deletecategoryoptionresponsetype != undefined && jsonObj.deletecategoryoptionresponsetype != null &&
                jsonObj.deletecategoryoptionresponsetype.result.successful == "true") {
                var category = getCurrentCategory();
                if(category != null) {
                	listCatOptions(category.id);
                	resetCatOption();
                }
            } else {
            	alert("failed to delete category option!");
            }
	    }
	    function listCatOptions(catId) {
	    	if(catId != null && catId != "") {
				var listType = new ListCategoryOptionType(catId);
				call_web_service(listType, listCatOptionsHandler);
			} else {
				alert("Please select a category.");
			}
	    }
	    function listCatOptionsHandler(jsonObj) {
	    	if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listcategoryoptionresponsetype != undefined && jsonObj.listcategoryoptionresponsetype != null && 
				jsonObj.listcategoryoptionresponsetype.result.successful == "true") {
				document.getElementById("categoryOption").innerHTML = ""; //clear the table
				var options = jsonObj.listcategoryoptionresponsetype.options;
				var count = jsonObj.listcategoryoptionresponsetype.total;
				
				if(options != undefined && options != null) {
	                if(count > 1) {
						for(var i = 0; i < count; i++) {
							addOptionRow("categoryOption", options[i], "fetchCatOption", "deleteCatOption");
						}
					} else {
						addOptionRow("categoryOption", options, "fetchCatOption", "deleteCatOption");
					}						
				}
				resetCatOption();
			}
	    }
	    function addOptionRow(tableID, optionObj, selectRowFunc, deleteRowFunc) {
	        var table = document.getElementById(tableID);
	
	        var rowCount = table.rows.length;
	        var rowId = tableID + "_r" + rowCount;
			
			var row = table.insertRow(rowCount);
			row.id = rowId;
	       	var innerHTML = "<td onclick='"+selectRowFunc+"("+optionObj.id+");'>"+optionObj.name+"</td><td><a href='javascript:"+deleteRowFunc+"("+optionObj.id+");'>X</a></td>";//</tr></tbody>
	       	row.innerHTML = innerHTML;
	       	row.onmouseover = function(){ highlightRow(this, true); };
	        row.onmouseout = function(){ highlightRow(this, false); };
	    }
	</script>
</head>

<body onload="javascript:listAllCategories();">
<table width="100%">
    <tr>
        <td width="18%" valign="top" align="left">
            <table width="100%" class="tableone" align="left">
                <caption>Categories</caption>
                <thead>
                <tr>
                    <th class="th1" scope="col">Name</th>
                    <th class="th2" scope="col"></th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                    <td colspan="2" align="center"><button onclick="javascript:newCategory();">New Category</button></td>
                </tr>
                </tfoot>
                <tbody>
	                <tr>
	                    <td colspan="5" valign="top" align="left">
	                        <div class="innerb">
	                            <table id ="category" class="tabletwo" width="100%">
	                            </table>
	                        </div>
	                    </td>
	                </tr>
                </tbody>
            </table>
        </td>
        <td valign="top" align="left">
        	<table id="categoryInfo" width="70%">
        		<tr>
        			<td align="left" valign="top">
        				Name: <input type="text" id="categoryName" readonly="readonly" value=""/>
        			</td>
        		</tr>
        		<tr>
        			<td align="left" valign="top">
        				Notes: <textarea id="categoryNotes" rows="3" cols="45" readonly="readonly" value=""></textarea>
        			</td>
        		</tr>
        		<tr>
        			<td>
        				Thumbnail: <input type="file" id="catThumb2" accept="image/*" disabled="disabled" onchange="updatePicture('categoryImg', this.value);"/>
        				<img id="categoryImg" src=""/>
        				<input type="hidden" id="catThumb" readonly="readonly">
        			</td>
        		</tr>
				<tr>
					<td>
						<table>
							<tr>
								<td>Printers:</td>
								<td id="catPrinterCell"></td>
							</tr>
						</table>
					</td>
				</tr>
        		<tr><td><button type="button" onclick="javascript:saveCategoryInfo();">Save</button></td></tr>
				
				<script language="javascript">setPrintersHTML("catPrinters", setPrintersHTMLHandler)</script>
				
        		<tr>
        			<td width="100%">
        				<div class="tabber" id="tab1">
							<div id="mainTab" class="tabbertab">
							    <h2 style="font-size: 20px"><a name="tab1">Menu Items</a></h2>
							    <table width="100%">
							    	<tr>
							    		<td width="20%">
							    			<table class="tableone" align="left">
								                <thead>
									                <tr>
									                    <th class="th1" scope="col">Name</th>
									                    <th class="th2" scope="col"></th>
									                </tr>
								                </thead>
								                <tfoot>
									                <tr>
									                    <td align="center" colspan="2"><button id="btnNewItem"  onclick="javascript:newItem();">New Item</button></td>
									                </tr>
								                </tfoot>
								                <tbody>
									                <tr>
									                    <td colspan="5">
									                        <div class="innerb">
									                            <table id ="menuItem" class="tabletwo">
									                            </table>
									                        </div>
									                    </td>
									                </tr>
							                	</tbody>
							            	</table>
							    		</td>
							    		<td valign="top">
							    			Item Details:
							    			<form name="itemDetails">
							    				<input type="hidden" name="itemId"/>
							            	<table name="itemTable" style="border:1px solid gray" width="100%">
					                    		<tr>
					                    			<td>
					                    				Name: <input type="text" id="itemName" name="itemName" value=""> <input type="checkbox" id="itemTaxable" name="itemTaxable" value="1"/>Taxable
					                    				<input type="checkbox" id="singleOption" name="singleOption" value="1"/>Allow only 1 option
					                    			</td>
					                    		</tr>
					                    		<tr>
					                    			<td valign="top">Description: <textarea name="itemDescription" id="itemDescription" rows="3" cols="45" value=""></textarea></td>
					                    		</tr>
					                    		<tr>
					                    			<td>
					                    				<input type="checkbox" id="hasSeasonPrice" name="hasSeasonPrice" value="1" onclick="javascript:enableSeasonalPrice();"/>Seasonal price
					                    				<input type="text" id="seasonPrice" name="seasonPrice" value="" />
					                    			</td>
					                    		</tr>
					                    		<tr>
					                    			<td>Default Price: <input type="text" id="defaultItemPrice" name="defaultItemPrice"></td>
					                    		</tr>
					                    		<tr>
					                    			<td>Default Takeout Price: <input type="text" id="defaultItemOutPrice" name="defaultItemOutPrice"></td>
					                    		</tr>
												<tr>
													<td>
														<table border="0" cellspacing="0" cellpadding="0">
															<tr>
																<td>Size</td>
																<td><input type="checkbox" id="hasDineInSizes" name="hasDineInSizes" onclick="javascript:enableDineInSizes(this.checked);"/>Dine-in</td>
																<td><input type="checkbox" id="hasTakeOutSizes" name="hasTakeOutSizes" onclick="javascript:enableTakeoutSizes(this.checked);"/>Take-out</td>
															</tr>
															<tr>
																<td>Small</td>
																<td><input id="smallPrice" name="smallPrice" type="text"/></td>
																<td><input id="smallOutPrice" name="smallOutPrice" type="text"/></td>
															</tr>
															<tr>
																<td>Medium</td>
																<td><input id="mediumPrice" name="mediumPrice" type="text"/></td>
																<td><input id="mediumOutPrice" name="mediumOutPrice" type="text"/></td>
															</tr>
															<tr>
																<td>Large</td>
																<td><input id="largePrice" name="largePrice" type="text"/></td>
																<td><input id="largeOutPrice" name="largeOutPrice" type="text"/></td>
															</tr>
														</table>
													</td>
												</tr>
					                    		<tr>
								        			<td>
								        				Thumbnail: <input type="file" id="itemThumb2" onchange="updatePicture('itemImg', this.value);"/><img id="itemImg" src=""/>
								        				<input type="hidden" id="itemThumb" value=""/>
								        			</td>
								        		</tr>
								        		<tr>
													<td>
														<table>
															<tr>
																<td>Printers:</td>
																<td id="itemPrinterCell"></td>
															</tr>
														</table>
													</td>
												</tr>
								        		<tr><td><button type="button" id="btnSaveItem" name="btnSaveItem" onclick="javascript:saveItemInfo();">Save</button></td></tr>
												<script language="javascript">setPrintersHTML("itemPrinters", setItemPrintersHTMLHandler)</script>
								            </table>
								            </form>
							    		</td>
							    	</tr>
							    </table>
							</div>
							
							<div id="adminTab" class="tabbertab">
							    <h2 style="font-size: 20px">Category Options</h2>
							    <table width="100%">
							    	<tr>
							    		<td width="20%">
							    			<table class="tableone" align="left">
								                <thead>
									                <tr>
									                    <th class="th1" scope="col">Name</th>
									                    <th class="th2" scope="col"></th>
									                </tr>
								                </thead>
								                <tfoot>
									                <tr>
									                    <td align="center" colspan="2"><button id="btnNewCatOption"  onclick="javascript:newCatOption();">New Option</button></td>
									                </tr>
								                </tfoot>
								                <tbody>
									                <tr>
									                    <td colspan="5">
									                        <div class="innerb">
									                            <table id ="categoryOption" class="tabletwo">
									                            </table>
									                        </div>
									                    </td>
									                </tr>
							                	</tbody>
							            	</table>
							    		</td>
							    		<td valign="top">
							    			Option Details:
							    			<form name="optionDetails">
							    			<input type="hidden" name="catOptionId"/>
							            	<table name="itemTable" style="border:1px solid gray" width="100%">
					                    		<tr>
					                    			<td>
					                    				Name: <input type="text" id="catOptionName" name="catOptionName" value=""> <input type="checkbox" id="catOptionTaxable" name="catOptionTaxable" value="1"/>Taxable
					                    			</td>
					                    		</tr>
					                    		<tr>
					                    			<td valign="top">Description: <textarea name="catOptionDescription" id="catOptionDescription" rows="3" cols="45" value=""></textarea></td>
					                    		</tr>
					                    		<tr>
					                    			<td>Default Price: <input type="text" id="catOptionPrice" name="catOptionPrice"></td>
					                    		</tr>
					                    		<tr>
					                    			<td>Default Takeout Price: <input type="text" id="catOptionOutPrice" name="catOptionOutPrice"></td>
					                    		</tr>
					                    		<tr>
								        			<td>
								        				Thumbnail: <input type="file" id="catOptionThumb2" onchange="updatePicture('itemImg', this.value);"/><img id="catOptionImg" src=""/>
								        				<input type="hidden" id="catOptionThumb" value=""/>
								        			</td>
								        		</tr>
								        		<tr><td><button type="button" id="btnSaveCatOption" name="btnSaveCatOption" onclick="javascript:saveCatOptionInfo();">Save</button></td></tr>
								            </table>
								            </form>
							    		</td>
							    	</tr>
							    </table>
							</div>
						</div>
					</td>
		    	</tr>
            </table>
        </td>
    </tr>
</table>

<script type="text/javascript">
						
   /* Since we specified manualStartup=true, tabber will not run after
      the onload event. Instead let's run it now, to prevent any delay
      while images load.
   */
   tabberAutomatic(tabberOptions);
						
</script>
</body>
</html>