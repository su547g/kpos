<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
   <title>KPOS - Place An Order</title>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta id="viewport" name="viewport" content="width=320; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="apple-touch-fullscreen" content="yes" />

    <script type="text/javascript" src="xml2json.js"></script>
    <script type="text/javascript" src="kpos.js"></script>
    <script type="text/javascript" src="popup.js"></script>
    <script type="text/javascript" src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js"></script>
    
    <link rel="stylesheet" href="example.css" TYPE="text/css" MEDIA="screen">
    
	<style type="text/css">
      body{
         font-size:14px;
         background:white;
         text-align:center;
      }

      .tableone {width:250px; border-collapse:collapse; margin:0 auto;}
      .tabletwo {width:220px; margin:2px; border:1px solid #B3B1B1; border-spacing: 1px; border-style:outset}

      .th1 {width:149px;}
      .th2 {width:99px;}
      .th3 {width:99px;}
      .th4 {width:99px;}
      .th5 {width:200px;}

      .td1 {width:149px;border:1px solid #B3B1B1;}
      .td2 {width:99px;}
      .td3 {width:99px;}
      .td4 {width:99px;}
      .td5 {width:170px;}

      .tableone {background:#697210; border:1px solid #fff; color:#fff;}
      .tableone td {border:1px solid #fff; color:#fff;}
      .tableone tbody {background:#f0c992; color:#000;}
      .tableone caption {background:#fff; color:#697210; font-size:1.2em; margin:0 auto;}
      .tableone th, .tabletwo th {text-align:left;}

      .tabletwo td {background:#eee; color:#000;}
      .tabletwo tr.dk th {background:#ddd; color:#000;}
      .tabletwo tr.dk td {background:#ddd; color:#000;}

      .innerb {height:30em; overflow:auto;}

      .categoryTable {border:1px solid gray; border-spacing:4px}
      .categoryTable td {
         border:0px;
         padding: 1px;
         color: #FFF;
         border-radius:3px;
         -moz-border-radius: 3px;
      }

      .menuItemTable {border:1px solid gray; border-spacing:1px}
      .menuItemTable td {
         border:1px solid black;
         padding:1px;
         background-color:#FFFFCC;
         border-radius:3px;
         -moz-border-radius: 3px;
      }

      .optionsTable {border:1px solid gray; border-spacing:1px}
      .optionsTable td {
         border:1px solid black;
         padding:1px;
         background-color:gray;
         color:#FFF;
         border-radius:3px;
         -moz-border-radius: 3px;
      }
      .orderTable {border:1px solid black; border-spacing:1px; border-radius:3px; -moz-border-radius: 3px;}
      .orderTable td {
      	 font-size:14px;
      	 color: blue;
      	 border:1px solid gray;
         padding:1px;
         border-radius:3px;
         -moz-border-radius: 3px;
      }
      .orderTable span {
      	text-indent: 15px;
      }
      .orderTabe th { border: 0px }
   	</style>

	<script language="javascript">
		function goLite(FRM,BTN) {
		   window.document.forms[FRM].elements[BTN].style.color = "#FFFF99";
		   window.document.forms[FRM].elements[BTN].style.backgroundColor = "#11AAEE";
		}
		function goDim(FRM,BTN) {
		   window.document.forms[FRM].elements[BTN].style.color = "#EEFFFF";
		   window.document.forms[FRM].elements[BTN].style.backgroundColor = "#0088DD";
		}
	</script>
	<script language="javascript">
		var catPage = 0, maxSize = 8, maxCatPage;
		var globalOptionPage = 0, glOptionMax = 10, maxGlobalOptionPage, glOpRowSize = 4;
		var catOptionPage = 0, catOptionMaxPerPage = 10, maxCatOptionPage, catOptionRowSize = 4;
		var itemPage = 0, itemMaxPerPage = 12, maxItemPage, itemRowSize = 3;
		var itemOptionPage = 0, itemOptMaxPerPage = 10, maxItemOptPage, itemOptionRowSize = 4;
		var taxRate = 0.08;
		var selectedItemIndex = -1, selectedOptionIndex = -1;
		
		var orderItems = new Array();
		var ORDER_TITLE_ROW_HTML = "<tr><th width='60%' valign='top' align='left'><strong>Items</strong></th><th width='5%' valign='top' align='right'><strong>Quantity</strong></th><th width='15%' valign='top' align='right'><strong>Price</strong></th></tr>";
		var GLOBAL_OP = "GLOBAL_OP", CAT_OP = "CAT_OP", ITEM_OP = "ITEM_OP";
		
		var smallClicked = 0, medClicked = 0, largeClicked = 0;
		
		var OUT = "OUT", DINE_IN = "DINE_IN", DELIVERY = "DELIVERY";
		var UserId = localStorage.getItem('userId');
		var OrderType = localStorage.getItem('orderType');
		var OrderId = localStorage.getItem('orderId');
		var TableId = localStorage.getItem('tableId');
		var TableName = localStorage.getItem('tableName');
		
		function addItemOptions(soapItem, jsItem) {
			if(soapItem.options) {
    			var options = soapItem.options;
    			if(options.length != undefined && options.length) {
    				for(var k = 0; k < options.length; k++) {
    					var itemOption = new OrderOption(options[k].displaytext, options[k].price, options[k].quantity, options[k].id, options[k].optiontype);
    					itemOption.id = options[k].id;
    					itemOption.optionId = options[k].optionid;
        				jsItem.childItems.push(itemOption);
    				}
    			} else {
    				var itemOption = new OrderOption(options.displaytext, options.price, options.quantity, options.id, options.optiontype);
    				itemOption.id = options.id;
    				itemOption.optionId = options.optionid;
        			jsItem.childItems.push(itemOption);
    			}
    		}
		}
		function fetchOrder(orderId) {
			var soapType = new FetchOrderType(orderId);
			call_web_service(soapType, fetchOrderHandler);
		}
		function fetchOrderHandler(response) {
			if(response != undefined && response != null &&
				response.fetchorderresponsetype != undefined && response.fetchorderresponsetype != null &&
				response.fetchorderresponsetype.result.successful == 'true') {
                var order = response.fetchorderresponsetype.order;
                document.orderForm.orderId.value = order.id;
                document.getElementById("orderHeader").innerText = "Order " + order.id;
                document.orderForm.orderType = order.type;
                document.orderForm.totalCharge = order.charge;
                TableId = order.tableid;
                TableName = order.tablename;
                if(TableName!=null && TableName!="") {
					document.getElementById("tableNameCell").innerText = TableName;
				}
                var items = order.orderitems;
                if(items.length != undefined && items.length != null) {
                	for(var i = 0; i < items.length; i++) {
                		var item = new OrderItem(items[i].displaytext, items[i].price, items[i].quantity, items[i].saleitemid);
                		item.id = items[i].id;
                		item.orderId = items[i].orderid;
                		addItemOptions(items[i], item);
                		orderItems.push(item);
                	}
                } else {
                	var item = new OrderItem(items.displaytext, items.price, items.quantity, items.id);
                	item.id = items.id;
                	item.orderId = items.orderid;
                	addItemOptions(items, item);
                	orderItems.push(item);
                }
                refreshOrderTable();
			}
		}
		function initializeOrder() {
			if(OrderId != null && OrderId > 0 && (OrderType == OUT || OrderType == DINE_IN || OrderType == DELIVERY)) {
				fetchOrder(OrderId);
			}
		}
		function clearOrder() {
			//localStorage.setItem('orderType', '');
			localStorage.setItem('orderId', '');
			localStorage.setItem('tableId', '');
			localStorage.setItem('tableName', '');
		}
		function initializeCategories(){
			ws_list_categories(listAllCategoriesHandler);
			listGlobalOptions();
		}
		function listAllCategoriesHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listcategoryresponsetype != undefined && jsonObj.listcategoryresponsetype != null &&
				jsonObj.listcategoryresponsetype.result.successful == 'true') {
				var count = jsonObj.listcategoryresponsetype.total;
                maxCatPage = Math.ceil(count / maxSize);
                if(maxCatPage > 0) maxCatPage--;
                pageCategories(0);
			}
		}
		function pageCategories(page) {
			if(page < 0 || page > maxCatPage) return;
			catPage = page;
			listCategories(catPage*maxSize, maxSize);
		}
		function listCategories(begin, maxSize) {
			var soapType = new ListCategoryHTMLType(begin, maxSize, "clickCategory");
			call_web_service(soapType, listCategoriesHandler);
		}
		function listCategoriesHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listcategoryhtmlresponsetype != undefined && jsonObj.listcategoryhtmlresponsetype != null && 
				jsonObj.listcategoryhtmlresponsetype.html != null) {
				var html = jsonObj.listcategoryhtmlresponsetype.html;
				html = html.replace(/&lt;/g, "<");
				html = html.replace(/&gt;/g, ">");
				html = html.replace(/&quot;/g, "'");
				document.getElementById("categoryTable").innerHTML = html;
			}
		}
		function listGlobalOptions() {
			var soapType = new ListGlobalOptionsType();
			call_web_service(soapType, listGlobalOptionsHandler);
		}
		function listGlobalOptionsHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listglobaloptionresponsetype != undefined && jsonObj.listglobaloptionresponsetype != null && 
				jsonObj.listglobaloptionresponsetype.result.successful == "true") {
				var count = jsonObj.listglobaloptionresponsetype.count;
				maxGlobalOptionPage = Math.ceil(count / glOptionMax);
				if(maxGlobalOptionPage > 0) maxGlobalOptionPage--;
				pageGlobalOptions(0);
			}
		}
		function pageGlobalOptions(page) {
			if(page < 0 || page > maxGlobalOptionPage) return;
			globalOptionPage = page;
			listGlobalOptionsHTML(glOpRowSize, globalOptionPage*glOptionMax, glOptionMax);
		}
		function listGlobalOptionsHTML(rowSize, begin, maxSize) {
			var soapType = new ListGlobalOptionHTMLType(rowSize, begin, maxSize, "clickGlobalOption");
			call_web_service(soapType, listGlobalOptionsHTMLHandler);
		}
		function listGlobalOptionsHTMLHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listglobaloptionhtmlresponsetype != undefined && jsonObj.listglobaloptionhtmlresponsetype != null && 
				jsonObj.listglobaloptionhtmlresponsetype.html != null) {
				html = jsonObj.listglobaloptionhtmlresponsetype.html;
				html = html.replace(/&lt;/g, "<");
				html = html.replace(/&gt;/g, ">");
				html = html.replace(/&quot;/g, "'");
				html = html.replace(/\\/g, "\"");
				document.getElementById("globalOptionsTable").innerHTML = html;
			}
		}
		function clickCategory(catId) {
			document.getElementById("categoryId").value = catId;
			listSaleItemsForCat(catId);
			listCatOptions(catId);
		}
		function clickGlobalOption(id, price, name) {
			//alert(id + " " + price + " " + name);
			if(selectedItemIndex >= 0) {
				var orderItem = orderItems[selectedItemIndex];
				//alert(orderItem.displayText + ", " + orderItem.price + ", " + orderItem.quantity);
				var optionItem = new OrderOption(name, price, 1, id, GLOBAL_OP);
				orderItem.childItems.push(optionItem);
				refreshOrderTable();
				Popup.hide('globalOptionsPopup');
			}
		}
		function listCatOptions(catId) {
			var listType = new ListCategoryOptionType(catId);
			call_web_service(listType, listCatOptionsHandler);
		}
		function listCatOptionsHandler(jsonObj) {
	    	if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listcategoryoptionresponsetype != undefined && jsonObj.listcategoryoptionresponsetype != null && 
				jsonObj.listcategoryoptionresponsetype.result.successful == "true") {
				var catId = jsonObj.listcategoryoptionresponsetype.catid;
				var count = jsonObj.listcategoryoptionresponsetype.total;
				//Max number of pages
				maxCatOptionPage = Math.ceil(count / catOptionMaxPerPage); 
				if(maxCatOptionPage > 0) maxCatOptionPage--;
				pageCatOptions(0);
			}
		}
		function pageCatOptions(page) {
			if(page < 0 || page > maxCatOptionPage) return;
			var catId = document.getElementById("categoryId").value;
			catOptionPage = page;
			listCategoryOptionHTML(catId, catOptionRowSize, catOptionPage*catOptionMaxPerPage, catOptionMaxPerPage);
		}
		function listCategoryOptionHTML(catId, rowSize, begin, maxSize) {
			var soapType = new ListCategoryOptionHTMLType(catId, rowSize, begin, maxSize, "clickCategoryOption");
			call_web_service(soapType, listCategoryOptionHTMLHandler);
		}
		function listCategoryOptionHTMLHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listcategoryoptionhtmlresponsetype != undefined && jsonObj.listcategoryoptionhtmlresponsetype != null && 
				jsonObj.listcategoryoptionhtmlresponsetype.html != null) {
				html = jsonObj.listcategoryoptionhtmlresponsetype.html;
				if(html != null && html.toString() != "[object Object]") {
					html = html.replace(/&lt;/g, "<");
					html = html.replace(/&gt;/g, ">");
					html = html.replace(/&quot;/g, "'");
					html = html.replace(/\\/g, "\"");
					document.getElementById("catOptionsTable").innerHTML = html;
				} else {
					document.getElementById("catOptionsTable").innerHTML = "";
				}
			}
		}
		function clickCategoryOption(id, price, name) {
			//alert(id + " " + name + " " + price);
			if(selectedItemIndex >= 0) {
				var orderItem = orderItems[selectedItemIndex];
				//alert(orderItem.displayText + ", " + orderItem.price + ", " + orderItem.quantity);
				var optionItem = new OrderOption(name, price, 1, id, CAT_OP);//aDisplayText, aPrice, aQuantity, aId, aType
				orderItem.childItems.push(optionItem);
				refreshOrderTable();
			}
		}
		function listSaleItemsForCat(catId) {
			if(catId != null && catId != "") {
				var listType = new ListSaleItemsForCategoryType(catId);
				call_web_service(listType, listSaleItemsForCatHandler);
			} else {
				alert("Please select a category.");
			}
		}
		function listSaleItemsForCatHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listsaleitemsforcategoryresponsetype != undefined && jsonObj.listsaleitemsforcategoryresponsetype != null && 
				jsonObj.listsaleitemsforcategoryresponsetype.result.successful == "true") {
				var catId = jsonObj.listsaleitemsforcategoryresponsetype.catid;
				var count = jsonObj.listsaleitemsforcategoryresponsetype.total;
				maxItemPage = Math.ceil(count / itemMaxPerPage); 
				if(maxItemPage > 0) maxItemPage--;
				pageItems(0);
			}
		}
		function pageItems(page) {
			if(page < 0 || page > maxItemPage) return;
			var catId = document.getElementById("categoryId").value;
			itemPage = page;
			listSaleItemHTML(catId, itemRowSize, itemPage*itemMaxPerPage, itemMaxPerPage);
		}
		function listSaleItemHTML(catId, rowSize, begin, maxSize) {
			var soapType = new ListSaleItemsForCategoryHTMLType(catId, rowSize, begin, maxSize, "clickSaleItem");
			call_web_service(soapType, listSaleItemHTMLHandler);
		}
		function listSaleItemHTMLHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listsaleitemsforcategoryhtmlresponsetype != undefined && jsonObj.listsaleitemsforcategoryhtmlresponsetype != null && 
				jsonObj.listsaleitemsforcategoryhtmlresponsetype.html != null) {
				html = jsonObj.listsaleitemsforcategoryhtmlresponsetype.html;
				if(html != null && html.toString() != "[object Object]") {
					html = html.replace(/&lt;/g, "<");
					html = html.replace(/&gt;/g, ">");
					html = html.replace(/&quot;/g, "'");
					html = html.replace(/\\/g, "\"");
					document.getElementById("menuItemTable").innerHTML = html;
				} else {
					document.getElementById("menuItemTable").innerHTML = "";
				}
			}
		}
		function clickSaleItem(itemId) {
			if(itemId != null && itemId != "") {
				document.getElementById("itemId").value = itemId;
				var soapType = new FetchSaleItemType(itemId, true);
				call_web_service(soapType, fetchSaleItemHandler);
			}
		}
		function setSizeButtonColor(size) {
			if(size == 1) {
				smallClicked = 1 - smallClicked; medClicked = 0; largeClicked = 0;
			} else if(size == 2) {
				medClicked = 1 - medClicked; smallClicked = 0; largeClicked = 0;
			} else {
				largeClicked = 1 - largeClicked; smallClicked = 0; medClicked = 0;
			}
			document.menuItemForm.btnItemSmall.style.backgroundColor = smallClicked==1?"white":"#FFFF00";
			document.menuItemForm.btnItemMed.style.backgroundColor = medClicked==1?"white":"#FFFF00";
			document.menuItemForm.btnItemLarge.style.backgroundColor = largeClicked==1?"white":"#FFFF00";
		}
		function fetchSaleItemHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
                jsonObj.fetchsaleitemresponsetype != undefined && jsonObj.fetchsaleitemresponsetype != null &&
                jsonObj.fetchsaleitemresponsetype.result.successful == "true") {
                var item = jsonObj.fetchsaleitemresponsetype.saleitem;
                document.menuItemForm.menuItemId.value = item.id;
                document.menuItemForm.itemName.value = item.name;
                document.getElementById('menuItemName').innerText = "Name: " + item.name;
                document.getElementById('menuItemDesc').innerText = "Description: " + item.description;
                var hasSizes = false;
                if(item.seasonprice != null && item.seasonprice > 0) {
                	document.getElementById('menuItemPrice').innerText = "Price: $" + item.seasonprice;
                	document.menuItemForm.itemPrice.value = item.seasonprice;
                	document.getElementById('singlePrice').style.display = "block";
                	document.getElementById('itemSizes').style.display = "none";                	
                } else if(OrderType == DINE_IN) { 
	                if((item.pricesmall!=null && item.pricesmall!=0) || 
	                			(item.pricemed!=null && item.pricemed!=0) || (item.pricelarge!=null && item.pricelarge!=0)) {
	                	hasSizes = true;
	            		document.menuItemForm.btnItemSmall.value = "Small $" + item.pricesmall;
	            		document.menuItemForm.btnItemSmall.style.backgroundColor = "#FFFF00";
	            		document.menuItemForm.btnItemSmall.onclick = function() {document.menuItemForm.itemPrice.value = item.pricesmall;setSizeButtonColor(1);}
	            		document.menuItemForm.btnItemSmall.style.display = (item.pricesmall !=null && item.pricesmall !="")?"block":"none";
	                	document.menuItemForm.btnItemMed.value = "Medium $" + item.pricemed;
	                	document.menuItemForm.btnItemMed.style.backgroundColor = "#FFFF00";
	                	document.menuItemForm.btnItemMed.onclick = function() {document.menuItemForm.itemPrice.value = item.pricemed;setSizeButtonColor(2);}
	                	document.menuItemForm.btnItemMed.style.display = (item.pricemed !=null && item.pricemed !="")?"block":"none";
	                	document.menuItemForm.btnItemLarge.value = "Large $" + item.pricelarge;
	                	document.menuItemForm.btnItemLarge.style.backgroundColor = "#FFFF00";
	                	document.menuItemForm.btnItemLarge.onclick = function() {document.menuItemForm.itemPrice.value = item.pricelarge;setSizeButtonColor(3);}
	                	document.menuItemForm.btnItemLarge.style.display = (item.pricelarge !=null && item.pricelarge !="")?"block":"none";
	                	document.getElementById('singlePrice').style.display = "none";
	                	document.getElementById('itemSizes').style.display = "block";
	                } else {
	                	document.getElementById('menuItemPrice').innerText = "Price: $" + item.normalprice;
	                	document.getElementById('singlePrice').style.display = "block";
	                	document.getElementById('itemSizes').style.display = "none";
	                }
                } else if(OrderType == OUT || OrderType == DELIVERY) { 
	                if((item.outpricesmall!=null && item.pricesmall!=0) || 
	                			(item.outpricemed!=null && item.outpricemed!=0) || (item.outpricelarge!=null && item.outpricelarge!=0)) {
	                	hasSizes = true;
	            		document.menuItemForm.btnItemSmall.value = "Small $" + item.outpricesmall;
	            		document.menuItemForm.btnItemSmall.style.backgroundColor = "#FFFF00";
	            		document.menuItemForm.btnItemSmall.onclick = function() {document.menuItemForm.itemPrice.value = item.outpricesmall;setSizeButtonColor(1);}
	            		document.menuItemForm.btnItemSmall.style.display = (item.pricesmall !=null && item.pricesmall !="")?"block":"none";
	                	document.menuItemForm.btnItemMed.value = "Medium $" + item.outpricemedium;
	                	document.menuItemForm.btnItemMed.style.backgroundColor = "#FFFF00";
	                	document.menuItemForm.btnItemMed.onclick = function() {document.menuItemForm.itemPrice.value = item.outpricemedium;setSizeButtonColor(2);}
	                	document.menuItemForm.btnItemMed.style.display = (item.outpricemedium !=null && item.outpricemedium !="")?"block":"none";
	                	document.menuItemForm.btnItemLarge.value = "Large $" + item.outpricelarge;
	                	document.menuItemForm.btnItemLarge.style.backgroundColor = "#FFFF00";
	                	document.menuItemForm.btnItemLarge.onclick = function() {document.menuItemForm.itemPrice.value = item.outpricelarge;setSizeButtonColor(3);}
	                	document.menuItemForm.btnItemLarge.style.display = (item.outpricelarge !=null && item.outpricelarge !="")?"block":"none";
	                	document.getElementById('singlePrice').style.display = "none";
	                	document.getElementById('itemSizes').style.display = "block";
	                } else {
	                	document.getElementById('menuItemPrice').innerText = "Price: $" + item.takeoutprice;
	                	document.getElementById('singlePrice').style.display = "block";
	                	document.getElementById('itemSizes').style.display = "none";
	                }
                }
                var itemOptions = item.options;
                if(itemOptions!=null) {
                	document.getElementById("itemOptionsRow").style.display = "block";
                	var table = document.getElementById("itemOptionsTable");
                	table.innerHTML = "";
                	var row = table.insertRow(table.rows.length);
                	var optionsHtml = "<td>";
                	var name = item.name + "_option";
                	if(itemOptions.length != undefined) { //Array of item options
                		for(var i = 0; i < itemOptions.length; i++) {
                			if(item.issingleoption) {
	        					optionsHtml += "<input type='radio' id='"+name+"' name='"+name+"' value='"+itemOptions[i].name+"^"+itemOptions[i].id+"^"+itemOptions[i].price+"'/>" + itemOptions[i].name+" ($"+itemOptions[i].price+")";
                			} else {
                				optionsHtml += "<input type='checkbox' id='"+name+"' name='"+ name + "' value='"+itemOptions[i].name+"^"+itemOptions[i].id+"^"+itemOptions[i].price+"'/>"+itemOptions[i].name+" ($"+itemOptions[i].price+")";
                			}
                		}
                		document.menuItemForm.optionsSize.value = itemOptions.length;
                	} else { //Single item option
                		document.menuItemForm.optionsSize.value = 1;
                		optionsHtml = "<input type='checkbox' id='"+name+"' name='"+ name + "' value='"+itemOptions.name+"^"+itemOptions.id+"^"+itemOptions.price+"'/>"+itemOptions.name+" ($"+itemOptions.price+")";
                	}
                	optionsHtml += "</td>";
                	row.innerHTML = optionsHtml;
                	document.menuItemForm.btnItemAdd.onclick = function() {addItemFromPopup(hasSizes);}
                	Popup.showModal('modal');
                } else if(hasSizes) {
                	document.menuItemForm.btnItemAdd.onclick = function() {addItemFromPopup(hasSizes);}
                	Popup.showModal('modal');
                } else {
                	document.getElementById("itemOptionsRow").style.display = "none";
                	addItem(item.name, OrderType==DINE_IN?item.normalprice:item.takeoutprice, 1, item.id);
                }
	        }
	   	}
	   	function addItem(name, price, quantity, itemId) {
	   		//alert(name + ", " + price + ", " + quantity);
	   		var item = new OrderItem(name, price, quantity, itemId);
	   		orderItems.push(item);
	   		refreshOrderTable();
	   		
	   		selectedItemIndex = orderItems.length - 1;
	   		selectedOptionIndex = -1;
	   		Popup.hide('modal');
	   	}
	   	function addItemFromPopup(hasSizes) {
	   		if(hasSizes && smallClicked == 0 && medClicked == 0 && largeClicked==0) { alert("Please pick a size!"); return;}
	   		
	   		var itemId = document.menuItemForm.menuItemId.value;
	   		if(itemId != null && itemId > 0) {
	   			var name = document.menuItemForm.itemName.value;
	   			var price = document.menuItemForm.itemPrice.value;
	   			var quantity = document.menuItemForm.menuItemQuantity.value;
	   			
	   			var item = new OrderItem(name, price, quantity, itemId);
	   			var options = document.getElementsByName(name+"_option");
	   			if(options != null) {
	   				if(document.menuItemForm.optionsSize.value > 1) {
		   				for (var i=0; i < options.length; i++) {
		   					if(options[i].checked) {
		   						var value = options[i].value;
		   						var temp = value.split("^");
		   						var option = new OrderOption(temp[0], temp[2], 1, temp[1], ITEM_OP); //(name, price, quantity, id, type)
		   						item.childItems.push(option); 
		   					}
		   				}
		   			} else {
		   				if(options.checked) {
	   						var value = options.value;
	   						var temp = value.split("^");
	   						var option = new OrderOption(temp[0], temp[2], 1, temp[1], ITEM_OP); //(name, price, quantity, id, type)
		   					item.childItems.push(option);
	   					}
		   			}
	   			}
	   			orderItems.push(item);
	   			
	   			selectedItemIndex = orderItems.length - 1;
	   			selectedOptionIndex = -1;
	   			refreshOrderTable();
	   			Popup.hide('modal');
	   		}
	   		document.getElementById('itemOptionsTable').innerHTML = "";
	   		document.getElementById("itemOptionsRow").style.display = "block";
	   	}
	   	function highlightOrderRow(index) {
	   		var table = document.getElementById("orderTable");
	   		var rowCount = table.rows.length;
	   		for(var i = 0; i < rowCount; i++) {
	            var row = table.rows[i];
	            if(row.id != null && row.id!= "") {
	            	if(row.id == index) {
		                row.style.background = '#dcfac9';
		                row.cells[0].style.background = '#dcfac9';
		                row.cells[1].style.background = '#dcfac9';
		                row.cells[2].style.background = '#dcfac9';
		            } else {
		                row.style.background = '';
		                row.cells[0].style.background = '';
		                row.cells[1].style.background = '';
		                row.cells[2].style.background = '';
		            }
	            }
	        }
	   	}
	   	function clickOrderItem(index) {
	   		//alert(index);
	   		selectedItemIndex = index;
	   		selectedOptionIndex = -1;
	   		var cell = document.getElementById("btmQty");
	   		cell.innerText = orderItems[index].quantity;
	   		
	   		highlightOrderRow(index);
	   	}
	   	function clickOptionItem(itemIndex, optionIndex) {
	   		selectedItemIndex = itemIndex;
	   		selectedOptionIndex = optionIndex;
	   		//alert(itemIndex + " - " + optionIndex);
	   		var cell = document.getElementById("btmQty");
	   		cell.innerText = orderItems[itemIndex].childItems[optionIndex].quantity;
	   		highlightOrderRow(itemIndex + "-" + optionIndex);
	   	}
	   	function refreshOrderTable() {
	   		var table = document.getElementById("orderTable");
            var total = 0, tax = 0;
            var html = ORDER_TITLE_ROW_HTML;
            for(var i = 0; i < orderItems.length; i++) {
            	var price = parseFloat(orderItems[i].price);
            	var quantity = parseInt(orderItems[i].quantity);
            	var itemPrice = price * quantity;
	            html += "<tr id='"+i+"'><td valign='top' align='left' onclick='clickOrderItem("+i+");'><strong>"+orderItems[i].displayText+"</strong></td>";
	            html += "<td valign='top' align='right''>"+orderItems[i].quantity+"</td>";
				html += "<td valign='top' align='right'><strong>"+(itemPrice==0?"":itemPrice.toFixed(2))+"</strong></td></tr>";
				for(var k = 0; k < orderItems[i].childItems.length; k++) {
					var optionItem = orderItems[i].childItems[k];
					var optionPrice = parseFloat(optionItem.price);
					var optionQuantity = parseInt(optionItem.quantity);
					var optionPrice = optionPrice * optionQuantity;
					html += "<tr id='"+i+"-"+k+"'><td valign='top' align='left' onclick='clickOptionItem("+i+","+k+")'>&nbsp;&nbsp;&nbsp;-&nbsp;"+optionItem.displayText+"</td>";
	            	html += "<td valign='top' align='right''>"+optionItem.quantity+"</td>";
					html += "<td valign='top' align='right'><strong>"+(optionPrice==0?"":optionPrice.toFixed(2))+"</strong></td></tr>";
					total += optionPrice;
				}
                total += itemPrice;
	        }
	        var discount = parseFloat(document.orderForm.totalDiscount.value);
	        
            html += "<tr><td colspan='2' valign='top' align='right'><strong>Subtotal:</strong> </td>";
            html += "<td valign='top' align='right'><strong>"+total.toFixed(2)+"</strong></td></tr>";
            
            if(discount > 0) {
            	html += "<tr><td colspan='2' valign='top' align='right'><strong>Discount:</strong> </td>";
            	html += "<td valign='top' align='right' id='orderDiscount'><strong>"+document.orderForm.totalDiscount.value+"</strong></td></tr>";
            
            	total -= discount;
            
            	html += "<tr><td colspan='2' valign='top' align='right'><strong>Subtotal:</strong> </td>";
            	html += "<td valign='top' align='right'><strong>"+total.toFixed(2)+"</strong></td></tr>";
            }
            tax = total * taxRate;
	        document.orderForm.totalTax.value = tax;
	        var grossTotal = (total+tax).toFixed(2);
	        
            html += "<tr><td colspan='3'><br></td></tr><tr><td colspan='2' valign='top' align='right'><strong>Tax:</strong> </td>";
            html += "<td valign='top' align='right'><strong>" + tax.toFixed(2) + "</strong></td></tr>";
            
            var charge = parseFloat(document.orderForm.totalCharge.value);
            if(charge > 0) {
            	html += "<tr><td colspan='3'><br></td></tr><tr><td colspan='2' valign='top' align='right'><strong>Charge:</strong> </td>";
            	html += "<td valign='top' align='right'><strong>" + charge + "</strong></td></tr>";
            }
            grossTotal = parseFloat(grossTotal) + charge;
            html += "<tr><td colspan='2' valign='top' align='right'><strong>TOTAL:</strong></td>";
            html += "<td valign='top' align='right'><strong>"+grossTotal.toFixed(2)+"</strong></td></tr>";
            table.innerHTML = html;
            
            document.orderForm.totalPrice.value = total;
	   	}
	   	function updateQuantity(increment) {
	   		if(selectedItemIndex >= 0) {
	   			var item = orderItems[selectedItemIndex];
	   			if(item != null) {
		   			var cell = document.getElementById("btmQty");
		   			if(selectedOptionIndex >= 0) {
		   				var option = item.childItems[selectedOptionIndex];
		   				option.quantity += increment;
		   				cell.innerText = option.quantity;
		   				if(option.quantity <= 0) {
		   					item.childItems.splice(selectedOptionIndex, 1);
		   				}
		   			} else {
		   				item.quantity += increment;
		   				cell.innerText = item.quantity;
		   				if(item.quantity <= 0) {
		   					orderItems.splice(selectedItemIndex, 1);
		   				}
		   			}
		   			refreshOrderTable();
		   		}
	   		}
	   	}
	   	function saveOrder() {
	   		if(orderItems != null && orderItems.length > 0) {
		   		var total = document.orderForm.totalPrice.value;
		   		var tax = document.orderForm.totalTax.value;
		   		var charge = document.orderForm.totalCharge.value;
		   		var orderId = document.orderForm.orderId.value;
		   		//aId, aType, aPrice, tax, tips, aStatus, aNumGuests, aCustomer, userId, tableId, aCharge
		   		var orderType = new SaveOrderType(orderId, OrderType, total, tax, 0, "INITIAL", 1, null, UserId, TableId, charge);
		   		orderType.order.orderItems = orderItems;
				call_web_service(orderType, saveOrderHandler);
			}
	   	}
	   	function saveOrderHandler(jsonObj) {
	   		if(jsonObj != undefined && jsonObj != null &&
				jsonObj.saveorderresponsetype != undefined && jsonObj.saveorderresponsetype != null && 
				jsonObj.saveorderresponsetype.result.successful == "true") {
				alert("Order saved!");
				document.orderForm.orderId.value = jsonObj.saveorderresponsetype.result.id;
				document.getElementById("orderHeader").innerText = "Order " + jsonObj.saveorderresponsetype.result.id;
				if(TableName!=null && TableName!="") {
					document.getElementById("tableNameCell").innerText = TableName;
				}
			} else {
				alert("Failed to save order!");
			}
	   	}
	   	function deleteOrder() {
	   		var orderId = document.orderForm.orderId.value;
	   		if(orderId != null && parseInt(orderId) > 0) {
	   			var soapType = new DeleteOrderType(orderId, UserId);
	   			call_web_service(soapType, deleteOrderHandler);
	   		} else {
	   			window.location.href = "index.html";
	   		}
	   	}
	   	function deleteOrderHandler(jsonObj) {
	   		if(jsonObj != undefined && jsonObj != null &&
				jsonObj.deleteorderresponsetype != undefined && jsonObj.deleteorderresponsetype != null && 
				jsonObj.deleteorderresponsetype.result.successful == "true") {
				document.orderForm.orderId.value = "";
				localStorage.setItem('curr_order_id', 0);
				window.location.href = "index.html";
			}
	   	}
        function printReceipt() {
            if(orderItems != null && orderItems.length > 0) {
                var orderId = document.orderForm.orderId.value;
                var printTicketReceipt = new PrintTicketReceipt(orderId);
                call_web_service(printTicketReceipt, printReceiptHandler);
            }
        }
        function printReceiptHandler(jsonObj) {
            if (jsonObj != undefined && jsonObj != null && jsonObj.PrintReceiptResponseType != undefined && jsonObj.PrintReceiptResponseType != null &&
                    jsonObj.PrintReceiptResponseType.result.successful == "true") {
                alert("Print successful!")
            } else {
                alert("Failed to print receipt!");
            }
        }
	   	
	   	var selectedField;
	   	function showPayment() {
	   		var total = (document.orderForm.totalPrice.value==null||document.orderForm.totalPrice.value=="")?0:parseFloat(document.orderForm.totalPrice.value);
	   		var charge = document.orderForm.totalCharge.value==null||document.orderForm.totalCharge.value==""?0:parseFloat(document.orderForm.totalCharge.value);
	   		total += charge;
	   		var tax = (document.orderForm.totalTax.value==null||document.orderForm.totalTax.value=="")?0:parseFloat(document.orderForm.totalTax.value);
	   		total += tax;
	   		document.payForm.saleAmt.value = total.toFixed(2);
	   		var tips = (document.payForm.tipsAmt.value==""||document.payForm.tipsAmt.value==null)?0:parseFloat(document.payForm.tipsAmt.value);
	   		document.payForm.dueAmt.value = (total + tips).toFixed(2);
	   		Popup.showModal('payment');
	   	}
    	function changeBackground(textField) {
    		textField.style.backgroundColor = "#72A4D2";
    		textField.style.color = "#FFFFFF";
    		selectedField = textField;
    	}
    	function resetBackground(textField) {
    		textField.style.backgroundColor = "white";
    		textField.style.color = "black";
    	}
    	function addValue(value) {
    		if(selectedField!=null)	{
    			if(selectedField.value=="0") selectedField.value = "";
    			selectedField.value = selectedField.value + value;
    			if(selectedField.id=='discAmt' || selectedField.id=='discPercent') {
    				calcDiscount(selectedField.id);
    			}
    			updateAmt();
    		}
    	}
    	function calcDiscount(id) {
    		var focusField = document.getElementById(id);
    		if(focusField.value != '' && focusField.value > 0) {
    			if(id == "discAmt") {
	    			document.getElementById('discPercent').value='';
	    		} else {
	    			document.getElementById('discAmt').value='';
	    		}
    		}
    	}
    	function updateAmt() {
    		var saleAmt = parseFloat(document.getElementById('saleAmt').value);
			var tax = document.getElementById('taxAmt').value==""?0:parseFloat(document.getElementById('taxAmt').value);
			var tips =  document.getElementById('tipsAmt').value==""?0:parseFloat(document.getElementById('tipsAmt').value);
			if(document.getElementById('discPercent').value!='' && document.getElementById('discPercent').value!=null) {
				saleAmt = saleAmt*(1-document.getElementById('discPercent').value/100);
			} else if(document.getElementById('discAmt').value!='' && document.getElementById('discAmt').value!=null) {
				saleAmt = saleAmt - document.getElementById('discAmt').value;
			}
			document.getElementById('dueAmt').value = (saleAmt + tax + tips).toFixed(2);
			if(document.getElementById('payAmt').value != '') {
				document.getElementById('changeAmt').value = document.getElementById('payAmt').value - document.getElementById('dueAmt').value;
			}
    	}
    	function setValue(value) {
    		if(selectedField!=null) {
    			selectedField.value = value;
    			updateAmt();
    		}
    	}
    	function calcChange() {
    		var dueAmt = document.getElementById('dueAmt').value==""?0:parseFloat(document.getElementById('dueAmt').value);
    		var payAmt = document.getElementById('payAmt').value==""?0:parseFloat(document.getElementById('payAmt').value);
    		if(payAmt >= dueAmt) {
    			document.getElementById("changeAmt").value = (payAmt - dueAmt).toFixed(2);
    		} else {
    			alert("Payment amount is not enough!");
    		}
    	}
    	function addTips(tips) {
    		if(selectedField.id == 'tipsAmt') {
	    		if(document.getElementById('saleAmt').value != null && document.getElementById('saleAmt').value != "") {
	    			var saleAmt = parseFloat(document.getElementById('saleAmt').value);
	    			var tipsAmt = saleAmt * tips;
	    			document.getElementById('tipsAmt').value = tipsAmt.toFixed(2);
	    			updateAmt();
	    		}
	    	} else if(selectedField.id == 'discPercent') {
	    		selectedField.value = tips * 100;
	    		document.getElementById('discAmt').value = "";
	    		updateAmt();
	    	}
    	}
    	function changeDiscBackground(textField) {
    		resetBackground(document.getElementById('discAmt2'));
    		resetBackground(document.getElementById('discPercent2'));
    		textField.style.backgroundColor = "#72A4D2";
    		textField.style.color = "#FFFFFF";
    		selectedField = textField;
    	}
    	function calcCharge() {
    		var charge = document.getElementById("chargeAmt2").value;
    		document.orderForm.totalCharge.value = charge;
    		Popup.hide("chargePopup");
    		refreshOrderTable();
    	}
    	function clearCharge() {
    		document.getElementById('chargeAmt2').value = '';
    		changeBackground(document.getElementById('chargeAmt2'));
    	}
    	function calcDiscount(rate) {
    		var dueAmt = document.orderForm.totalPrice.value==""?0:parseFloat(document.orderForm.totalPrice.value);
    		document.orderForm.totalDiscount.value = dueAmt * rate / 100;
    		refreshOrderTable();
    		Popup.hide("discountPopup");
    	}
    	function flipCharge() {
    		var charge = document.getElementById("chargeAmt2").value * -1;
    		document.getElementById("chargeAmt2").value = charge;
    	}
    	function listDiscounts() {
    		var soapType = new ListDiscountsType();
    		call_web_service(soapType, listDiscountsHandler);
    	}
    	function listDiscountsHandler(response) {
    		if(response != undefined && response != null &&
				response.listratesresponsetype != undefined && response.listratesresponsetype != null && 
				response.listratesresponsetype.result.successful == "true") {
				var count = response.listratesresponsetype.count;
				var html = "";
				if(count == 1) {
					var rate = response.listratesresponsetype.rate;
					html += "<input type='button' value='"+rate+"' class='numberbutton' onclick='calcDiscount("+rate+")'/>";
				} else if(count > 1) {
					for(var i = 0; i < count; i++) {
						var rate = response.listratesresponsetype.rate[i];
						html += "<input type='button' value='"+rate+"' class='numberbutton' onclick='calcDiscount("+rate+")'/>";
					}
				}
				document.getElementById("discPercentRow").innerHTML = html;
				Popup.showModal('discountPopup');
			}
    	}
	</script>
</head>

<body onload="initializeCategories();initializeOrder();" onunload="clearOrder()">
   <div style="position:absolute; left:10px; top:10px; width:95%">
   	<table>
		<tr><td><input type="button" class="navibutton" onclick="window.location.href='index.html';" value="<< Back"></td>
	</table>
      <table width="100%" style="border:1px solid gray; border-spacing:2px">
         <tr>
            <td valign="top" align="left" width="18%" style="border:0px solid black; padding:2px">
               <strong>Menu Categories</strong>
               <input type="hidden" id="categoryId"/>
               <table id="categoryTable" class="categoryTable" width="100%">
               </table>
               <table width="100%">
               		<tr>
               			<td width="100%"><input type="button" class="smallbackbutton" onclick="pageCategories(catPage - 1);">
               			<input type="button" class="smallnextbutton" onclick="pageCategories(catPage + 1);"></td>
               		</tr>
               </table>
           </td>
           <td valign="top" align="left" width="20%" style="border:0px solid black; padding:2px">
               <strong>Menu Items</strong>
               <input type="hidden" id="itemId"/>
               <table id="menuItemTable" class="menuItemTable" width="100%">
               </table>
               <table width="100%">
               		<tr>
               			<td width="100%"><input type="button" class="smallbackbutton" onclick="pageItems(itemPage - 1);">
               			<input type="button" class="smallnextbutton" onclick="pageItems(itemPage + 1);"></td>
               		</tr>
               </table>
            </td>
            <td valign="top" align="left" width="22.5%" style="border:0px solid black; padding:2px">
               <input type="button" class="mediumbutton" value="Global Options" onclick="Popup.showModal('globalOptionsPopup');"/>
               <br>
               <br>
               <strong>Category Options</strong>
               <table id="catOptionsTable" class="optionsTable" width="100%">
               </table>
               <table width="100%">
               		<tr>
               			<td width="100%"><input type="button" class="smallbackbutton" onclick="pageCatOptions(catOptionPage - 1);">
               			<input type="button" class="smallnextbutton" onclick="pageCatOptions(catOptionPage + 1);"></td>
               		</tr>
               </table>
            </td>
            <td width="36%" valign="top" align="left" style="border:0px solid black">
               <form name="orderForm">
               	<input type="hidden" name="orderId"/>
               	<input type="hidden" name="orderType"/>
               	<input type="hidden" name="totalDiscount" value="0"/>
               	<input type="hidden" name="totalTax"/>
               	<input type="hidden" name="totalPrice"/>
               	<input type="hidden" name="totalCharge" value="0"/>
               	<table width="100%">
               		<tr>
               			<th colspan="2" width="100%" valign="center" align="center" id="orderHeader">Order</th>
                	</tr>
                	<tr>
                		<td>Table: </td><td id="tableNameCell"></td>
                	</tr>
                	<tr>
                		<td>Server: </td><td id="serverNameCell"></td>
                	</tr>
                	<script>
           				if(TableName!=null && TableName!="") {
							document.getElementById("tableNameCell").innerText = TableName;
						}
           			</script>
               	</table>
               <table width="100%" border="0" id="orderTable" class="orderTable">
                  <tr>
                     <th width="60%" valign="top" align="left"><strong>Items</strong></th>
                     <th width="5%" valign="top" align="right"><strong>Quantity</strong></th>
                     <th width="15%" valign="top" align="right"><strong>Price</strong></th>
                  </tr>
                  <tr><td colspan="3"><br></td></tr>
                  <tr>
                     <td colspan="2" valign="top" align="right"><strong>Tax:</strong> </td>
                     <td valign="top" align="right"><strong></strong></td>
                  </tr>
                  <tr>
                     <td colspan="2" valign="top" align="right"><strong>Total:</strong> </td>
                     <td valign="top" align="right"><strong></strong></td>
                  </tr>
               </table>
               </form>
               <table>
                   <tr>
                   		<td>Quantity:</td><td id="btmQty"></td>
                   		<td>
                   			<input type="button" name="btnPlus" value="" class="plusbutton" onclick="updateQuantity(1);"/>
                   			<input type="button" name="btnMinus" value="" class="minusbutton" onclick="updateQuantity(-1);"/>
                   		</td>
                   </tr>
                   <tr>
                   		<td colspan="2">
                   			<input type="button" name="btnDiscount" value="Discount" class="groovybutton" onclick="listDiscounts();"/>
                   			<input type="button" name="btnCharge" value="Charge" class="groovybutton" onclick="clearCharge(); Popup.showModal('chargePopup');"/>
                   			<input type="button" id="btnTable" value="Change Table" class="groovybutton" onclick="showTablePopup();" disabled="true"/>
                   			<script>
                   				if(OrderType == DINE_IN) {
                   					document.getElementById("btnTable").disabled = false;
                   				}
                   			</script>
                   		</td>
                   </tr>
                   <tr>
                   		<td colspan="2">
                   			<input type="button" name="btnSave" value="Save Order" class="groovybutton" onclick="saveOrder();"/>
                   			<input type="button" name="btnDelete" value="Void Order" class="groovybutton" onclick="deleteOrder();"/>
                   			<input type="button" name="btnPay" value="Pay" class="groovybutton" onclick="showPayment();"/>
                            <input type="button" name="btnPrintReceipt" value="Print Receipt" class="groovybutton" onclick="printReceipt();"/>
                   		</td>
                   </tr>
               </table>
            </td>
         </tr>
      </table>
   </div>
   <div id="globalOptionsPopup" style="width:450px; height: 400px; border:1px solid #CC6600; background-color:white; padding:5px; font-size:100%; display:none;">
   	   <strong>Global Options</strong>
	   <table id="globalOptionsTable" class="optionsTable" width="100%">
	   </table>
       <table width="100%">
		<tr>
			<td width="100%">
				<input type="button" class="smallbackbutton" onclick="pageGlobalOptions(globalOptionPage - 1);">
				<input type="button" class="smallnextbutton" onclick="pageGlobalOptions(globalOptionPage + 1);">
			</td>
	    </tr>
       </table>
       <input type="button" class="mediumbutton" value="Close" onclick="Popup.hide('globalOptionsPopup')"/>
   </div>
   <div id="modal" style="width:450px; height: 400px; border:2px solid #CC6600; background-color:white; padding:5px; font-size:100%; display:none;">
	<table border="0" width="100%">
		<form name="menuItemForm" id="menuItemForm">
			<input type="hidden" name="menuItemId" value=""/>
			<input type="hidden" name="itemName" value=""/>
			<input type="hidden" name="itemPrice" value=""/>
			<input type="hidden" name="optionsSize" value=""/>
		<tr>
			<td align="left" valign="top" id="menuItemName" name="menuItemName"></td>
		</tr>
		<tr>
			<td align="left" valign="top" id="menuItemDesc" name="menuItemDesc"></td>
		</tr>
		<tr id="singlePrice">
			<td align="left" id="menuItemPrice" name="menuItemPrice"></td>
		</tr>
		<tr>
			<td align="left">Quantity:<select id="menuItemQuantity" name="menuItemQuantity">
					<option value=1>1</option>
					<option value=2>2</option>
					<option value=3>3</option>
					<option value=4>4</option>
					<option value=5>5</option>
				</select>
			</td>
		</tr>
		<tr>
			<td align="left" valign="top">
				<table id="itemSizes" width="100%" style="display: block">
					<tr>
						<td width="33.3%"><input type="button" name="btnItemSmall" value="" class="groovybutton" onclick=""/></td>
						<td width="33.3%"><input type="button" name="btnItemMed"  value="" class="groovybutton" onclick=""/></td>
						<td width="33.3%"><input type="button" name="btnItemLarge" value="" class="groovybutton" onclick=""/></td>
					</tr>
				</table>
			</td>
		</tr>
		<tr id="itemOptionsRow" style="display: none">
			<td><strong>Item Options</strong>
	           	<table id="itemOptionsTable" class="optionsTable" width="100%">
	           	</table>
           	</td>
		</tr>
		
		<tr><td >&nbsp;</td></tr>
		<tr id="confirmRow">
			<td align="center">
				<input type="button" name="btnItemAdd" class="cancelbutton" onclick="" value="ADD"></input>
				<input type="button" class="cancelbutton" onclick="Popup.hide('modal')" value="CANCEL"></input>
			</td>
		</tr>
		</form>
	</table>
  </div>
  <div id="discountPopup" style="width:550px; height: 350px; border:2px solid #CC6600; background-color:white; padding:2px; font-size:100%; display:none;">
  	<table width="100%">
  		<tr>
  			<td>
				<div style="float:left">
					<table width="100%">
						<tr><td>Discount Rates</td></tr>
						<tr id="discPercentRow"></tr>
					</table>
				</div>
  			</td>
		</tr>
		<tr>
			<td align="center" width="100%">
				<table width="100%">
					<tr>
						<td align="center" width="100%">
							<!--<input type="button" name="btnSettle" value="Apply Discount" class="settlebutton" onclick="calcChange2()"/>-->
							<input type="button" name="btnClose" value="Close" class="settlebutton" onclick="Popup.hide('discountPopup')"/>
						</td>
					</tr>
				</table>
			</td>
		</tr>
  	</table>
  </div>
  <div id="chargePopup" style="width:550px; height: 350px; border:2px solid #CC6600; background-color:white; padding:2px; font-size:100%; display:none;">
  	<table width="100%">
  		<tr>
  			<td>
  				<div style="float:left">
					<table style="border:0px" width="100%">
						<tr>
							<td align="left"><strong><font color="#6600FF">Charge:</font></strong></td>
							<td align="left">
								$<input type="text" id="chargeAmt2" value='' size="6" style="font-size:14px;font-weight:bold" onkeyup="calcCharge('chargeAmt2')"/> 
							</td>
						</tr>
					</table>
				</div>
				<div style="float:left; width:20px">&nbsp;</div>
				<div style="float:left">
					<table width="100%">
						<tr>
							<td><input type="button" name="btnFlip" value="-" class="numberbutton" onclick="flipCharge()"/></td>
							<td colspan="2" align="center"><input type="button" name="btnClear" value="Clear" class="numberbutton2" onclick="setValue(0)"/></td>
						</tr>
						<tr>
							<td width="33.3%"><input type="button" name="btnSeven" value="7" class="numberbutton" onclick="addValue('7')"/></td>
							<td width="33.3%"><input type="button" name="btnEight" value="8" class="numberbutton" onclick="addValue('8')"/></td>
							<td width="33.3%"><input type="button" name="btnNine" value="9" class="numberbutton" onclick="addValue('9')"/></td>
						</tr>
						<tr>
							<td width="33.3%"><input type="button" name="btnFour" value="4" class="numberbutton" onclick="addValue('4')"/></td>
							<td width="33.3%"><input type="button" name="btnFive" value="5" class="numberbutton" onclick="addValue('5')"/></td>
							<td width="33.3%"><input type="button" name="btnSix" value="6" class="numberbutton" onclick="addValue('6')"/></td>
						</tr>
						<tr>
							<td width="33.3%"><input type="button" name="btnOne" value="1" class="numberbutton" onclick="addValue('1')"/></td>
							<td width="33.3%"><input type="button" name="btnTwo" value="2" class="numberbutton" onclick="addValue('2')"/></td>
							<td width="33.3%"><input type="button" name="btnThree" value="3" class="numberbutton" onclick="addValue('3')"/></td>
						</tr>
						<tr>
							<td colspan="2"><input type="button" name="btnZero" value="0" class="numberbutton2" onclick="addValue('0')"/></td>
							<td><input type="button" name="btnDot" value="." class="numberbutton" onclick="addValue('.')"/></td>
						</tr>
					</table>
				</div>
  			</td>
		</tr>
		<tr>
			<td align="center" width="100%">
				<table width="100%">
					<tr>
						<td align="center" width="100%">
							<input type="button" name="btnSettle" value="Apply" class="settlebutton" onclick="calcCharge()"/>
							<input type="button" name="btnClose" value="Close" class="settlebutton" onclick="clearCharge();Popup.hide('chargePopup')"/>
						</td>
					</tr>
				</table>
			</td>
		</tr>
  	</table>
  </div>
	<div id="payment" style="width:650px; height: 400px; border:2px solid #CC6600; background-color:white; padding:2px; font-size:100%; display:none;">
		<table width="100%">
			
			<tr>
				<td width="100%">
					<div style="float:left">
						<table style="border:0px" width="100%">
						<form name="payForm">
							<tr>
								<td align="left"><strong>Sale:</strong></td>
								<td align="left"><input type="text" id="saleAmt" name="saleAmt" style="font-size:14px;font-weight:bold" onfocus="changeBackground(this)"/></td>
							</tr>
							<tr>
								<td align="left"><strong><font color="#6600FF">Tips:</font></strong></td>
								<td align="left"><input type="text" id="tipsAmt" name="tipsAmt" style="font-size: 14px;font-weight:bold" onfocus="changeBackground(this)" onkeyup="updateAmt()"/></td>
							</tr>
							<tr>
								<td align="left"><strong>Due Amount:</strong></td>
								<td align="left"><input type="text" id="dueAmt" name="dueAmt" style="font-size: 14px;font-weight:bold" onfocus="changeBackground(this)"/></td>
							</tr>
							<tr>
								<td align="left"><strong>Pay Amount:</strong></td>
								<td align="left"><input type="text" id="payAmt" name="payAmt" style="font-size: 14px;font-weight:bold" onfocus="changeBackground(this)" onkeyup="updateAmt()"/></td>
							</tr>
							<tr>
								<td colspan="2"><hr></td>
							</tr>
							<tr>
								<td align="left"><strong>Change:</strong></td>
								<td align="left"><input type="text" id="changeAmt" name="changeAmt" style="font-size: 14px;font-weight:bold" onfocus="changeBackground(this)"/></td>
							</tr>
						</form>
						</table>
					</div>
					<div style="float:left; width:20px">&nbsp;</div>
					<div style="float:left">
						<table width="100%">
							<tr>
								<td><input type="button" name="btnTip10" value="10%" class="tipsbutton" onclick="addTips(0.1)"/></td>
								<td width="33.3%"><input type="button" name="btnSeven" value="7" class="numberbutton" onclick="addValue('7')"/></td>
								<td width="33.3%"><input type="button" name="btnEight" value="8" class="numberbutton" onclick="addValue('8')"/></td>
								<td width="33.3%"><input type="button" name="btnNine" value="9" class="numberbutton" onclick="addValue('9')"/></td>
							</tr>
							<tr>
								<td><input type="button" name="btnTip15" value="15%" class="tipsbutton" onclick="addTips(0.15)"/></td>
								<td width="33.3%"><input type="button" name="btnFour" value="4" class="numberbutton" onclick="addValue('4')"/></td>
								<td width="33.3%"><input type="button" name="btnFive" value="5" class="numberbutton" onclick="addValue('5')"/></td>
								<td width="33.3%"><input type="button" name="btnSix" value="6" class="numberbutton" onclick="addValue('6')"/></td>
							</tr>
							<tr>
								<td><input type="button" name="btnTip20" value="20%" class="tipsbutton" onclick="addTips(0.2)"/></td>
								<td width="33.3%"><input type="button" name="btnOne" value="1" class="numberbutton" onclick="addValue('1')"/></td>
								<td width="33.3%"><input type="button" name="btnTwo" value="2" class="numberbutton" onclick="addValue('2')"/></td>
								<td width="33.3%"><input type="button" name="btnThree" value="3" class="numberbutton" onclick="addValue('3')"/></td>
							</tr>
							<tr>
								<td></td>
								<td><input type="button" name="btnZero" value="0" class="numberbutton" onclick="addValue('0')"/></td>
								<td><input type="button" name="btnDot" value="." class="numberbutton" onclick="addValue('.')"/></td>
								<td align="center"><input type="button" name="btnClear" value="C" class="numberbutton" onclick="setValue(0)"/></td>
							</tr>
						</table>
					</div>
					<div style="float:left">
						<table width="100%">
							<tr>
								<td><input type="button" name="btnFiveDlr" value="$5" class="dollarbutton" onclick="setValue(5)"/></td>
								<td><input type="button" name="btnHundredDlr" value="$100" class="dollarbutton" onclick="setValue(100)"/></td>
							</tr>
							<tr>
								<td><input type="button" name="btnTenDlr" value="$10" class="dollarbutton" onclick="setValue(10)"/></td>
							</tr>
							<tr>
								<td><input type="button" name="btnTwentyDlr" value="$20" class="dollarbutton" onclick="setValue(20)"/></td>
							</tr>
							<tr>
								<td><input type="button" name="btnFiftyDlr" value="$50" class="dollarbutton" onclick="setValue(50)"/></td>
							</tr>
						</table>
					</div>
				</td>
			</tr>
			<tr><td><hr></td></tr>
			<tr>
				<td width="100%" align="left">
					<table border="0" width="100%">
						<tr>
							<td width="20%"><strong>Payment Options:</strong></td>
							<td>
								<input type="button" name="btnCash" value="Cash" class="paymentbutton" onclick="calcChange()"/>
								<input type="button" name="btnCredit" value="Credit Card" class="creditbutton" onclick=""/>
								<input type="button" name="btnClose" value="Close" class="creditbutton" onclick="Popup.hide('payment')"/>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
	</div>
	<div id="pickTable" style="width:700px; height: 530px; border:1px solid #CC6600; background-color:#99997A; padding:0px; font-size:100%; display:none;">
		<table width="100%">
			<tr>
				<td width="100%" align="left">
					<input type="button" value="OK" onclick="confirmTable()"/>
					<input type="button" value="Cancel" onclick="Popup.hide('pickTable')"/>
				</td>
			</tr>
			<tr>
				<td>
					<table id="areaList"></table>
				</td>
			</tr>
			<tr>
				<td>
					<input type="hidden" id="tableId"/>
					<input type="hidden" id="tableName"/>
					<div id="pageContainer" style="outline:solid black thin; width: 680px; height: 400px; background-color: #F5DA81; float: left"></div>
				</td>
			</tr>
		</table>
	</div>
</body>
	<script>
		var tableNum = 0;
	    var areas = new Array();
		var tables = {};
		var container = document.getElementById('pageContainer');
		var containerX = container.offsetLeft;
		var containerY = container.offsetTop;
		var _tableWidth = 50;
		
		function showTablePopup() {
			listSeatingAreas();
			Popup.showModal('pickTable');
		}
		function clearTables() {
			while (container.hasChildNodes()) {
			    container.removeChild(container.lastChild);
			}
		}
		function listSeatingAreas() {
			var soapType = new ListAreasType();
			call_web_service(soapType, listSeatingAreasHandler);
		}
		function loadTables(soapTables) {
			if(soapTables != null) {
				if(soapTables.length != undefined) {
					for(var k = 0; k < soapTables.length; k++) {
						var domainTable = soapTables[k];
						tables[domainTable.name] = new Table(domainTable.id, domainTable.name, domainTable.x, domainTable.y, domainTable.areaid);
					}
				} else {
					tables[soapTables.name] = new Table(soapTables.id, soapTables.name, soapTables.x, soapTables.y, soapTables.areaid);
				}
			}
		}
		function listSeatingAreasHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listareasresponsetype != undefined && jsonObj.listareasresponsetype != null && 
				jsonObj.listareasresponsetype.result.successful == "true") {
				if(jsonObj.listareasresponsetype.areas != null) {
					areas = new Array();
					tables = {};
					if(jsonObj.listareasresponsetype.areas.length != undefined) {
						for(var i = 0; i < jsonObj.listareasresponsetype.areas.length; i++) {
							var name = jsonObj.listareasresponsetype.areas[i].name;
							var id = jsonObj.listareasresponsetype.areas[i].id;
							areas.push(new SaveAreaType(name, id));
							var soapTables = jsonObj.listareasresponsetype.areas[i].tables;
							if(soapTables != null) {
								loadTables(soapTables);
							}
						}
					} else {
						areas.push(new SaveAreaType(jsonObj.listareasresponsetype.areas.name, jsonObj.listareasresponsetype.areas.id));
						loadTables(jsonObj.listareasresponsetype.areas.tables);
					}
					var html = "<tr>";
					for(var i = 0; i < areas.length; i++) {
						html += "<td><input type='button' onclick='clickSeatingArea(\"area_"+i+"\","+i+")' value='" + areas[i].name + "' id='area_"+i+"' class='mediumbutton'/></td>";
					}
					html += "</tr>"
					document.getElementById("areaList").innerHTML = html;
					clearTables();
				}
			} else {
				alert("Failed to load seating areas!");
			}
		}
		function clickSeatingArea(id, i) {
			var button = document.getElementById(id);
			button.style.backgroundColor = "#2ECCFA";
			for(var k = 0; k < areas.length; k++) {
				if(k!=i) document.getElementById("area_"+k).style.backgroundColor = "#FFFF00";
			} 
			var area = areas[i];
			clearTables();

			var tableDiv, x, y;
			for(var t in tables) {
				if(tables[t].areaId == area.id) {
			        tableDiv = document.createElement('div');
					//tableDiv.setAttribute('src', 'img/tan-square.png');
					x = containerX+tables[t].x;
					y = containerY+tables[t].y;
			        tableDiv.setAttribute('class', 'drag');
			        tableDiv.setAttribute('id', tables[t].name);
			        tableDiv.setAttribute('style', 'border:solid black 1px;width:'+_tableWidth+'px;height:'+_tableWidth+'px;background-color:brown;left:'+x+'px;top:'+y+'px;');
			        tableDiv.innerHTML = '<br><center>' + tables[t].name + '</center>';
			        tableDiv.onclick = function() { clickTable(this); }
			        container.appendChild(tableDiv);
				}
			}
		}
		function clickTable(tableDiv) {
			tableDiv.style.backgroundColor = "#2ECCFA";
			selected = tableDiv.id;
			document.getElementById("tableId").value = tables[selected].id;
			document.getElementById("tableName").value = tableDiv.id;
			for(var t in tables) {
				if(tables[t].name != tableDiv.id && document.getElementById(t)!=null) {
					document.getElementById(t).style.backgroundColor = "brown";
				}
			}
		}
		function confirmTable() {
			localStorage.setItem("tableId", document.getElementById("tableId").value);
			localStorage.setItem("tableName", document.getElementById("tableName").value);
			var TableId = document.getElementById("tableId").value;
			var TableName = document.getElementById("tableName").value;
			document.getElementById("tableNameCell").innerText = TableName;
			Popup.hide("pickTable");
		}
	</script>
</html>
