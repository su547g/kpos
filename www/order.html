<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
   <title></title>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta id="viewport" name="viewport" content="width=320; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="apple-touch-fullscreen" content="yes" />

    <script type="text/javascript" src="xml2json.js"></script>
    <script type="text/javascript" src="kpos.js"></script>
    <script type="text/javascript" src="popup.js"></script>
    <script type="text/javascript" src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js"></script>
    
    <link rel="stylesheet" href="example.css" TYPE="text/css" MEDIA="screen">
    
	<style type="text/css">
      body{
         font-size:14px;
         background:white; //#F2F2F2; //c4f0f1;
         text-align:center;
      }

      .tableone {width:250px; border-collapse:collapse; margin:0 auto;}
      .tabletwo {width:220px; margin:2px; border:1px solid #B3B1B1; border-spacing: 1px; border-style:outset}

      .th1 {width:149px;}
      .th2 {width:99px;}
      .th3 {width:99px;}
      .th4 {width:99px;}
      .th5 {width:200px;}

      .td1 {width:149px;border:1px solid #B3B1B1;}
      .td2 {width:99px;}
      .td3 {width:99px;}
      .td4 {width:99px;}
      .td5 {width:170px;}

      .tableone {background:#697210; border:1px solid #fff; color:#fff;}
      .tableone td {border:1px solid #fff; color:#fff;}
      .tableone tbody {background:#f0c992; color:#000;}
      .tableone caption {background:#fff; color:#697210; font-size:1.2em; margin:0 auto;}
      .tableone th, .tabletwo th {text-align:left;}

      .tabletwo td {background:#eee; color:#000;}
      .tabletwo tr.dk th {background:#ddd; color:#000;}
      .tabletwo tr.dk td {background:#ddd; color:#000;}

      .innerb {height:30em; overflow:auto;}

      .categoryTable {border:1px solid gray; border-spacing:4px}
      .categoryTable td {
         border:0px;
         padding: 1px;
         //background-color:#F07800; //FF742E; //3399FF;
         color: #FFF; //003366;
         border-radius:3px;
         -moz-border-radius: 3px;
      }

      .menuItemTable {border:1px solid gray; border-spacing:1px}
      .menuItemTable td {
         border:1px solid black;
         padding:1px;
         background-color:#FFFFCC;
         border-radius:3px;
         -moz-border-radius: 3px;
      }

      .optionsTable {border:1px solid gray; border-spacing:1px}
      .optionsTable td {
         border:1px solid black;
         padding:1px;
         background-color:gray;//#3399FF;
         color:#FFF;
         border-radius:3px;
         -moz-border-radius: 3px;
      }
      .orderTable {border:1px solid black; border-spacing:1px border-radius:3px; -moz-border-radius: 3px;}
      .orderTable td {
      	 font-size:14px;
      	 color: blue;
      	 border:1px solid gray;
         padding:1px;
         border-radius:3px;
         -moz-border-radius: 3px;
      }
      .orderTable span {
      	text-indent: 15px;
      }
      .orderTabe th { border: 0px }
   	</style>

	<script language="javascript">
		function goLite(FRM,BTN) {
		   window.document.forms[FRM].elements[BTN].style.color = "#FFFF99";
		   window.document.forms[FRM].elements[BTN].style.backgroundColor = "#11AAEE";
		}
		function goDim(FRM,BTN) {
		   window.document.forms[FRM].elements[BTN].style.color = "#EEFFFF";
		   window.document.forms[FRM].elements[BTN].style.backgroundColor = "#0088DD";
		}
	</script>
	<script language="javascript">
		var catPage = 0, maxSize = 8, maxCatPage;
		var globalOptionPage = 0, glOptionMax = 10, maxGlobalOptionPage, glOpRowSize = 4;
		var catOptionPage = 0, catOptionMaxPerPage = 10, maxCatOptionPage, catOptionRowSize = 4;
		var itemPage = 0, itemMaxPerPage = 12, maxItemPage, itemRowSize = 3;
		var itemOptionPage = 0, itemOptMaxPerPage = 10, maxItemOptPage, itemOptionRowSize = 4;
		var taxRate = 0.08;
		var selectedItemIndex = -1, selectedOptionIndex = -1;
		
		var orderItems = new Array();
		var ORDER_TITLE_ROW_HTML = "<tr><th width='60%' valign='top' align='left'><strong>Items</strong></th><th width='5%' valign='top' align='right'><strong>Quantity</strong></th><th width='15%' valign='top' align='right'><strong>Price</strong></th></tr>";
		var GLOBAL_OP = "GLOBAL_OP", CAT_OP = "CAT_OP", ITEM_OP = "ITEM_OP";
		
		var smallClicked = 0, medClicked = 0, largeClicked = 0;
		
		function initializeCategories(){
			ws_list_categories(listAllCategoriesHandler);
			listGlobalOptions();
		}
		function listAllCategoriesHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listcategoryresponsetype != undefined && jsonObj.listcategoryresponsetype != null &&
				jsonObj.listcategoryresponsetype.result.successful == 'true') {
				var count = jsonObj.listcategoryresponsetype.total;
                maxCatPage = Math.ceil(count / maxSize);
                if(maxCatPage > 0) maxCatPage--;
                pageCategories(0);
			}
		}
		function pageCategories(page) {
			if(page < 0 || page > maxCatPage) return;
			catPage = page;
			listCategories(catPage*maxSize, maxSize);
		}
		function listCategories(begin, maxSize) {
			var soapType = new ListCategoryHTMLType(begin, maxSize, "clickCategory");
			call_web_service(soapType, listCategoriesHandler);
		}
		function listCategoriesHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listcategoryhtmlresponsetype != undefined && jsonObj.listcategoryhtmlresponsetype != null && 
				jsonObj.listcategoryhtmlresponsetype.html != null) {
				var html = jsonObj.listcategoryhtmlresponsetype.html;
				html = html.replace(/&lt;/g, "<");
				html = html.replace(/&gt;/g, ">");
				html = html.replace(/&quot;/g, "'");
				document.getElementById("categoryTable").innerHTML = html;
			}
		}
		function listGlobalOptions() {
			var soapType = new ListGlobalOptionsType();
			call_web_service(soapType, listGlobalOptionsHandler);
		}
		function listGlobalOptionsHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listglobaloptionresponsetype != undefined && jsonObj.listglobaloptionresponsetype != null && 
				jsonObj.listglobaloptionresponsetype.result.successful == "true") {
				var count = jsonObj.listglobaloptionresponsetype.count;
				maxGlobalOptionPage = Math.ceil(count / glOptionMax);
				if(maxGlobalOptionPage > 0) maxGlobalOptionPage--;
				pageGlobalOptions(0);
			}
		}
		function pageGlobalOptions(page) {
			if(page < 0 || page > maxGlobalOptionPage) return;
			globalOptionPage = page;
			listGlobalOptionsHTML(glOpRowSize, globalOptionPage*glOptionMax, glOptionMax);
		}
		function listGlobalOptionsHTML(rowSize, begin, maxSize) {
			var soapType = new ListGlobalOptionHTMLType(rowSize, begin, maxSize, "clickGlobalOption");
			call_web_service(soapType, listGlobalOptionsHTMLHandler);
		}
		function listGlobalOptionsHTMLHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listglobaloptionhtmlresponsetype != undefined && jsonObj.listglobaloptionhtmlresponsetype != null && 
				jsonObj.listglobaloptionhtmlresponsetype.html != null) {
				html = jsonObj.listglobaloptionhtmlresponsetype.html;
				html = html.replace(/&lt;/g, "<");
				html = html.replace(/&gt;/g, ">");
				html = html.replace(/&quot;/g, "'");
				html = html.replace(/\\/g, "\"");
				document.getElementById("globalOptionsTable").innerHTML = html;
			}
		}
		function clickCategory(catId) {
			document.getElementById("categoryId").value = catId;
			listSaleItemsForCat(catId);
			listCatOptions(catId);
		}
		function clickGlobalOption(id, price, name) {
			alert(id + " " + price + " " + name);
			if(selectedItemIndex >= 0) {
				var orderItem = orderItems[selectedItemIndex];
				alert(orderItem.displayText + ", " + orderItem.price + ", " + orderItem.quantity);
				var optionItem = new OrderOption(name, price, 1, id, GLOBAL_OP);
				orderItem.childItems.push(optionItem);
				refreshOrderTable();
			}
		}
		function listCatOptions(catId) {
			var listType = new ListCategoryOptionType(catId);
			call_web_service(listType, listCatOptionsHandler);
		}
		function listCatOptionsHandler(jsonObj) {
	    	if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listcategoryoptionresponsetype != undefined && jsonObj.listcategoryoptionresponsetype != null && 
				jsonObj.listcategoryoptionresponsetype.result.successful == "true") {
				var catId = jsonObj.listcategoryoptionresponsetype.catid;
				var count = jsonObj.listcategoryoptionresponsetype.total;
				//Max number of pages
				maxCatOptionPage = Math.ceil(count / catOptionMaxPerPage); 
				if(maxCatOptionPage > 0) maxCatOptionPage--;
				pageCatOptions(0);
			}
		}
		function pageCatOptions(page) {
			if(page < 0 || page > maxCatOptionPage) return;
			var catId = document.getElementById("categoryId").value;
			catOptionPage = page;
			listCategoryOptionHTML(catId, catOptionRowSize, catOptionPage*catOptionMaxPerPage, catOptionMaxPerPage);
		}
		function listCategoryOptionHTML(catId, rowSize, begin, maxSize) {
			var soapType = new ListCategoryOptionHTMLType(catId, rowSize, begin, maxSize, "clickCategoryOption");
			call_web_service(soapType, listCategoryOptionHTMLHandler);
		}
		function listCategoryOptionHTMLHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listcategoryoptionhtmlresponsetype != undefined && jsonObj.listcategoryoptionhtmlresponsetype != null && 
				jsonObj.listcategoryoptionhtmlresponsetype.html != null) {
				html = jsonObj.listcategoryoptionhtmlresponsetype.html;
				if(html != null && html.toString() != "[object Object]") {
					html = html.replace(/&lt;/g, "<");
					html = html.replace(/&gt;/g, ">");
					html = html.replace(/&quot;/g, "'");
					html = html.replace(/\\/g, "\"");
					document.getElementById("catOptionsTable").innerHTML = html;
				} else {
					document.getElementById("catOptionsTable").innerHTML = "";
				}
			}
		}
		function clickCategoryOption(id, price, name) {
			alert(id + " " + name + " " + price);
			if(selectedItemIndex >= 0) {
				var orderItem = orderItems[selectedItemIndex];
				alert(orderItem.displayText + ", " + orderItem.price + ", " + orderItem.quantity);
				var optionItem = new OrderOption(name, price, 1, id, CAT_OP);//aDisplayText, aPrice, aQuantity, aId, aType
				orderItem.childItems.push(optionItem);
				refreshOrderTable();
			}
		}
		function listSaleItemsForCat(catId) {
			if(catId != null && catId != "") {
				var listType = new ListSaleItemsForCategoryType(catId);
				call_web_service(listType, listSaleItemsForCatHandler);
			} else {
				alert("Please select a category.");
			}
		}
		function listSaleItemsForCatHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listsaleitemsforcategoryresponsetype != undefined && jsonObj.listsaleitemsforcategoryresponsetype != null && 
				jsonObj.listsaleitemsforcategoryresponsetype.result.successful == "true") {
				var catId = jsonObj.listsaleitemsforcategoryresponsetype.catid;
				var count = jsonObj.listsaleitemsforcategoryresponsetype.total;
				maxItemPage = Math.ceil(count / itemMaxPerPage); 
				if(maxItemPage > 0) maxItemPage--;
				pageItems(0);
			}
		}
		function pageItems(page) {
			if(page < 0 || page > maxItemPage) return;
			var catId = document.getElementById("categoryId").value;
			itemPage = page;
			listSaleItemHTML(catId, itemRowSize, itemPage*itemMaxPerPage, itemMaxPerPage);
		}
		function listSaleItemHTML(catId, rowSize, begin, maxSize) {
			var soapType = new ListSaleItemsForCategoryHTMLType(catId, rowSize, begin, maxSize, "clickSaleItem");
			call_web_service(soapType, listSaleItemHTMLHandler);
		}
		function listSaleItemHTMLHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
				jsonObj.listsaleitemsforcategoryhtmlresponsetype != undefined && jsonObj.listsaleitemsforcategoryhtmlresponsetype != null && 
				jsonObj.listsaleitemsforcategoryhtmlresponsetype.html != null) {
				html = jsonObj.listsaleitemsforcategoryhtmlresponsetype.html;
				if(html != null && html.toString() != "[object Object]") {
					html = html.replace(/&lt;/g, "<");
					html = html.replace(/&gt;/g, ">");
					html = html.replace(/&quot;/g, "'");
					html = html.replace(/\\/g, "\"");
					document.getElementById("menuItemTable").innerHTML = html;
				} else {
					document.getElementById("menuItemTable").innerHTML = "";
				}
			}
		}
		function clickSaleItem(itemId) {
			if(itemId != null && itemId != "") {
				document.getElementById("itemId").value = itemId;
				var soapType = new FetchSaleItemType(itemId, true);
				call_web_service(soapType, fetchSaleItemHandler);
			}
		}
		function setSizeButtonColor(size) {
			if(size == 1) {
				smallClicked = 1 - smallClicked; medClicked = 0; largeClicked = 0;
				document.menuItemForm.btnItemSmall.style.backgroundColor = smallClicked==1?"white":"#FFFF00";
			} else if(size == 2) {
				medClicked = 1 - medClicked; smallClicked = 0; largeClicked = 0;
				document.menuItemForm.btnItemMed.style.backgroundColor = medClicked==1?"white":"#FFFF00";
			} else {
				largeClicked = 1 - largeClicked; smallClicked = 0; medClicked = 0;
				document.menuItemForm.btnItemLarge.style.backgroundColor = largeClicked==1?"white":"#FFFF00";
			}
		}
		function fetchSaleItemHandler(jsonObj) {
			if(jsonObj != undefined && jsonObj != null &&
                jsonObj.fetchsaleitemresponsetype != undefined && jsonObj.fetchsaleitemresponsetype != null &&
                jsonObj.fetchsaleitemresponsetype.result.successful == "true") {
                var item = jsonObj.fetchsaleitemresponsetype.saleitem;
                document.menuItemForm.menuItemId.value = item.id;
                document.menuItemForm.itemName.value = item.name;
                document.getElementById('menuItemName').innerText = "Name: " + item.name;
                document.getElementById('menuItemDesc').innerText = "Description: " + item.description;
                var hasSizes = false;
                if(item.seasonprice != null && item.seasonprice > 0) {
                	document.getElementById('menuItemPrice').innerText = "Price: $" + item.seasonprice;
                	document.menuItemForm.itemPrice.value = item.seasonprice;
                	document.getElementById('singlePrice').style.display = "block";
                	document.getElementById('itemSizes').style.display = "none";                	
                } 
                //TODO: This comparison needs to consider order type!
                else if((item.pricesmall!=null && item.pricesmall!=0) && 
                			(item.pricemed!=null && item.pricemed!=0) && (item.pricelarge!=null && item.pricelarge!=0)) {
                	//TODO: check order type for price
                	hasSizes = true;
                	document.menuItemForm.btnItemSmall.value = "Small $" + item.pricesmall;
                	document.menuItemForm.btnItemSmall.style.backgroundColor = "#FFFF00";
                	document.menuItemForm.btnItemSmall.onclick = function() {document.menuItemForm.itemPrice.value = item.pricesmall;setSizeButtonColor(1);}
                	document.menuItemForm.btnItemMed.value = "Medium $" + item.pricemed;
                	document.menuItemForm.btnItemMed.style.backgroundColor = "#FFFF00";
                	document.menuItemForm.btnItemMed.onclick = function() {document.menuItemForm.itemPrice.value = item.pricemed;setSizeButtonColor(2);}
                	document.menuItemForm.btnItemLarge.value = "Large $" + item.pricelarge;
                	document.menuItemForm.btnItemLarge.style.backgroundColor = "#FFFF00";
                	document.menuItemForm.btnItemLarge.onclick = function() {document.menuItemForm.itemPrice.value = item.pricelarge;setSizeButtonColor(3);}
                	document.getElementById('singlePrice').style.display = "none";
                	document.getElementById('itemSizes').style.display = "block";
                } else { //
                	//TODO: check order type for price
                	document.getElementById('menuItemPrice').innerText = "Price: $" + item.normalprice;
                	document.getElementById('singlePrice').style.display = "block";
                	document.getElementById('itemSizes').style.display = "none";
                }
                var itemOptions = item.options;
                if(itemOptions!=null) {
                	document.getElementById("itemOptionsRow").style.display = "block";
                	var table = document.getElementById("itemOptionsTable");
                	table.innerHTML = "";
                	var row = table.insertRow(table.rows.length);
                	var optionsHtml = "<td>";
                	var name = item.name + "_option";
                	if(itemOptions.length != undefined) { //Array of item options
                		for(var i = 0; i < itemOptions.length; i++) {
                			if(item.issingleoption) {
	        					optionsHtml += "<input type='radio' id='"+name+"' name='"+name+"' value='"+itemOptions[i].name+"^"+itemOptions[i].id+"^"+itemOptions[i].price+"'/>" + itemOptions[i].name+" ($"+itemOptions[i].price+")";
                			} else {
                				optionsHtml += "<input type='checkbox' id='"+name+"' name='"+ name + "' value='"+itemOptions[i].name+"^"+itemOptions[i].id+"^"+itemOptions[i].price+"'/>"+itemOptions[i].name+" ($"+itemOptions[i].price+")";
                			}
                		}
                		document.menuItemForm.optionsSize.value = itemOptions.length;
                	} else { //Single item option
                		document.menuItemForm.optionsSize.value = 1;
                		optionsHtml = "<input type='checkbox' id='"+name+"' name='"+ name + "' value='"+itemOptions.name+"^"+itemOptions.id+"^"+itemOptions.price+"'/>"+itemOptions.name+" ($"+itemOptions.price+")";
                	}
                	optionsHtml += "</td>";
                	row.innerHTML = optionsHtml;
                	document.menuItemForm.btnItemAdd.onclick = function() {addItemFromPopup(hasSizes);}
                	Popup.showModal('modal');
                } else if(hasSizes) {
                	document.menuItemForm.btnItemAdd.onclick = function() {addItemFromPopup(hasSizes);}
                	Popup.showModal('modal');
                } else {
                	document.getElementById("itemOptionsRow").style.display = "none";
                	//TODO: Check order type for price
                	addItem(item.name, item.normalprice, 1, item.id);
                }
	        }
	   	}
	   	function addItem(name, price, quantity, itemId) {
	   		//alert(name + ", " + price + ", " + quantity);
	   		var item = new OrderItem(name, price, quantity, itemId);
	   		orderItems.push(item);
	   		refreshOrderTable();
	   		
	   		selectedItemIndex = orderItems.length - 1;
	   		selectedOptionIndex = -1;
	   		Popup.hide('modal');
	   	}
	   	function addItemFromPopup(hasSizes) {
	   		if(hasSizes && smallClicked == 0 && medClicked == 0 && largeClicked==0) { alert("Please pick a size!"); return;}
	   		
	   		var itemId = document.menuItemForm.menuItemId.value;
	   		if(itemId != null && itemId > 0) {
	   			var name = document.menuItemForm.itemName.value;
	   			var price = document.menuItemForm.itemPrice.value;
	   			var quantity = document.menuItemForm.menuItemQuantity.value;
	   			
	   			var item = new OrderItem(name, price, quantity, itemId);
	   			var options = document.getElementById(name+"_option");
	   			if(options != null) {
	   				if(document.menuItemForm.optionsSize.value > 1) {
		   				for (var i=0; i < options.length; i++) {
		   					if(options[i].checked) {
		   						var value = options[i].value;
		   						var temp = value.split("^");
		   						var option = new OrderOption(temp[0], temp[2], 1, temp[1], ITEM_OP); //(name, price, quantity, id, type)
		   						item.childItems.push(option); 
		   					}
		   				}
		   			} else {
		   				if(options.checked) {
	   						var value = options.value;
	   						var temp = value.split("^");
	   						var option = new OrderOption(temp[0], temp[2], 1, temp[1], ITEM_OP); //(name, price, quantity, id, type)
		   					item.childItems.push(option);
	   					}
		   			}
	   			}
	   			orderItems.push(item);
	   			
	   			selectedItemIndex = orderItems.length - 1;
	   			selectedOptionIndex = -1;
	   			refreshOrderTable();
	   			Popup.hide('modal');
	   		}
	   		document.getElementById('itemOptionsTable').innerHTML = "";
	   		document.getElementById("itemOptionsRow").style.display = "block";
	   	}
	   	function highlightOrderRow(index) {
	   		var table = document.getElementById("orderTable");
	   		var rowCount = table.rows.length;
	   		for(var i = 0; i < rowCount; i++) {
	            var row = table.rows[i];
	            if(row.id != null && row.id!= "") {
	            	if(row.id == index) {
		                row.style.background = '#dcfac9';
		                row.cells[0].style.background = '#dcfac9';
		                row.cells[1].style.background = '#dcfac9';
		                row.cells[2].style.background = '#dcfac9';
		            } else {
		                row.style.background = '';
		                row.cells[0].style.background = '';
		                row.cells[1].style.background = '';
		                row.cells[2].style.background = '';
		            }
	            }
	        }
	   	}
	   	function clickOrderItem(index) {
	   		alert(index);
	   		selectedItemIndex = index;
	   		selectedOptionIndex = -1;
	   		var cell = document.getElementById("btmQty");
	   		cell.innerText = orderItems[index].quantity;
	   		
	   		highlightOrderRow(index);
	   	}
	   	function clickOptionItem(itemIndex, optionIndex) {
	   		selectedItemIndex = itemIndex;
	   		selectedOptionIndex = optionIndex;
	   		alert(itemIndex + " - " + optionIndex);
	   		var cell = document.getElementById("btmQty");
	   		cell.innerText = orderItems[itemIndex].childItems[optionIndex].quantity;
	   		highlightOrderRow(itemIndex + "-" + optionIndex);
	   	}
	   	function refreshOrderTable() {
	   		var table = document.getElementById("orderTable");
            var total = 0, tax = 0;
            var html = ORDER_TITLE_ROW_HTML;
            for(var i = 0; i < orderItems.length; i++) {
            	var price = parseFloat(orderItems[i].price);
            	var quantity = parseInt(orderItems[i].quantity);
	            html += "<tr id='"+i+"'><td valign='top' align='left' onclick='clickOrderItem("+i+");'><strong>"+orderItems[i].displayText+"</strong></td>";
	            html += "<td valign='top' align='right''>"+orderItems[i].quantity+"</td>";
				html += "<td valign='top' align='right'><strong>"+(price==0?"":price.toFixed(2))+"</strong></td></tr>";
				for(var k = 0; k < orderItems[i].childItems.length; k++) {
					var optionItem = orderItems[i].childItems[k];
					var optionPrice = parseFloat(optionItem.price);
					var optionQuantity = parseInt(optionItem.quantity);
					html += "<tr id='"+i+"-"+k+"'><td valign='top' align='left' onclick='clickOptionItem("+i+","+k+")'>&nbsp;&nbsp;&nbsp;-&nbsp;"+optionItem.displayText+"</td>";
	            	html += "<td valign='top' align='right''>"+optionItem.quantity+"</td>";
					html += "<td valign='top' align='right'><strong>"+(optionPrice==0?"":optionPrice.toFixed(2))+"</strong></td></tr>";
					total += optionPrice * optionQuantity;
				}
                total += price * quantity;
	        }
	        tax = total * taxRate;
	        document.orderForm.totalTax.value = tax;
	        var grossTotal = (total+tax).toFixed(2);
            html += "<tr><td colspan='2' valign='top' align='right'><strong>Subtotal:</strong> </td>";
            html += "<td valign='top' align='right'><strong>"+total.toFixed(2)+"</strong></td></tr>";
            html += "<tr><td colspan='3'><br></td></tr><tr><td colspan='2' valign='top' align='right'><strong>Tax:</strong> </td>";
            html += "<td valign='top' align='right'><strong>" + tax.toFixed(2) + "</strong></td></tr>";
            html += "<tr><td colspan='2' valign='top' align='right'><strong>TOTAL:</strong></td>";
            html += "<td valign='top' align='right'><strong>"+grossTotal+"</strong></td></tr>";
            table.innerHTML = html;
            document.orderForm.totalPrice.value = total;
            
            /*if(selectedItemIndex > -1) {
            	if(selectedOptionIndex > -1 && ) highlightOrderRow(selectedItemIndex + "-" + selectedOptionIndex);
            	else highlightOrderRow(selectedItemIndex);
            }*/
	   	}
	   	function updateQuantity(increment) {
	   		if(selectedItemIndex >= 0) {
	   			var item = orderItems[selectedItemIndex];
	   			if(item != null) {
		   			var cell = document.getElementById("btmQty");
		   			if(selectedOptionIndex >= 0) {
		   				var option = item.childItems[selectedOptionIndex];
		   				option.quantity += increment;
		   				cell.innerText = option.quantity;
		   				if(option.quantity <= 0) {
		   					item.childItems.splice(selectedOptionIndex, 1);
		   				}
		   			} else {
		   				item.quantity += increment;
		   				cell.innerText = item.quantity;
		   				if(item.quantity <= 0) {
		   					orderItems.splice(selectedItemIndex, 1);
		   				}
		   			}
		   			refreshOrderTable();
		   		}
	   		}
	   	}
	   	function saveOrder() {
	   		if(orderItems != null && orderItems.length > 0) {
		   		var total = document.orderForm.totalPrice.value;
		   		var tax = document.orderForm.totalTax.value;
		   		var orderId = document.orderForm.orderId.value;
		   		var orderType = new SaveOrderType(orderId, "OUT", total, tax, 0, "INITIAL", 1, null);//aId, aType, aPrice, aStatus, aNumGuests, aCustomer
		   		orderType.order.orderItems = orderItems;
				call_web_service(orderType, saveOrderHandler);
			}
	   	}
	   	function saveOrderHandler(jsonObj) {
	   		if(jsonObj != undefined && jsonObj != null &&
				jsonObj.saveorderresponsetype != undefined && jsonObj.saveorderresponsetype != null && 
				jsonObj.saveorderresponsetype.result.successful == "true") {
				alert("Order saved!");
				document.orderForm.orderId.value = jsonObj.saveorderresponsetype.id;
				document.getElementById("orderHeader").innerText = "Order " + jsonObj.saveorderresponsetype.result.id;
			} else {
				alert("Failed to save order!");
			}
	   	}
	   	function deleteOrder() {
	   		var orderId = document.orderForm.orderId.value;
	   		if(orderId != null && parseInt(orderId) > 0) {
	   			var soapType = new DeleteOrderType(orderId);
	   			call_web_service(soapType, deleteOrderHandler);
	   		}
	   	}
	   	function deleteOrderHandler(jsonObj) {
	   		if(jsonObj != undefined && jsonObj != null &&
				jsonObj.deleteorderresponsetype != undefined && jsonObj.deleteorderresponsetype != null && 
				jsonObj.deleteorderresponsetype.result.successful == "true") {
				document.orderForm.orderId.value = "";
				localStorage.setItem('curr_order_id', 0);
				window.location.href = "home.html";
			}
	   	}
	   	
	   	var selectedField;
	   	function showPayment() {
	   		var total = (document.orderForm.totalPrice.value==null||document.orderForm.totalPrice.value=="")?0:parseFloat(document.orderForm.totalPrice.value);
	   		var tax = (document.orderForm.totalTax.value==null||document.orderForm.totalTax.value=="")?0:parseFloat(document.orderForm.totalTax.value);
	   		document.payForm.saleAmt.value = total;
	   		document.payForm.taxAmt.value = tax;
	   		var tips = (document.payForm.tipsAmt.value==""||document.payForm.tipsAmt.value==null)?0:parseFloat(document.payForm.tipsAmt.value);
	   		document.payForm.dueAmt.value = (total+tax+tips).toFixed(2);
	   		Popup.showModal('payment');
	   	}
    	function changeBackground(textField) {
    		resetBackground(document.getElementById('taxAmt'));
    		resetBackground(document.getElementById('tipsAmt'));
    		resetBackground(document.getElementById('dueAmt'));
    		resetBackground(document.getElementById('payAmt'));
    		resetBackground(document.getElementById('changeAmt'));
    		
    		textField.style.backgroundColor = "#72A4D2";
    		textField.style.color = "#FFFFFF";
    		selectedField = textField;
    	}
    	function resetBackground(textField) {
    		textField.style.backgroundColor = "white";
    		textField.style.color = "black";
    	}
    	function addValue(value) {
    		if(selectedField!=null)	{
    			selectedField.value += value;
    			updateAmt();
    		}
    	}
    	function updateAmt() {
    		var saleAmt = parseFloat(document.getElementById('saleAmt').value);
			var tax = document.getElementById('taxAmt').value==""?0:parseFloat(document.getElementById('taxAmt').value);
			var tips =  document.getElementById('tipsAmt').value==""?0:parseFloat(document.getElementById('tipsAmt').value);
			document.getElementById('dueAmt').value = (saleAmt + tax + tips).toFixed(2);
			if(document.getElementById('payAmt').value != '') {
				document.getElementById('changeAmt').value = document.getElementById('payAmt').value - document.getElementById('dueAmt').value;
			}
    	}
    	function setValue(value) {
    		if(selectedField!=null) selectedField.value = value;
    	}
    	function calcChange() {
    		var dueAmt = document.getElementById('dueAmt').value==""?0:parseFloat(document.getElementById('dueAmt').value);
    		var payAmt = document.getElementById('payAmt').value==""?0:parseFloat(document.getElementById('payAmt').value);
    		if(payAmt >= dueAmt) {
    			document.getElementById("changeAmt").value = (payAmt - dueAmt).toFixed(2);
    		} else {
    			alert("Payment amount is not enough!");
    		}
    	}
	</script>
</head>

<body onload="javascript:initializeCategories();">
   <div style="position:absolute; left:10px; top:10px; width:95%">
   	<table>
		<tr><td><input type="button" class="navibutton" onclick="window.location.href='home.html';" value="<< Back"></td>
	</table>
      <table width="100%" style="border:1px solid gray; border-spacing:2px">
         <tr>
            <td valign="top" align="left" width="18%" style="border:0px solid black; padding:2px">
               <strong>Menu Categories</strong>
               <input type="hidden" id="categoryId"/>
               <table id="categoryTable" class="categoryTable" width="100%">
               </table>
               <table width="100%">
               		<tr>
               			<td width="100%"><input type="button" class="smallbackbutton" onclick="pageCategories(catPage - 1);">
               			<input type="button" class="smallnextbutton" onclick="pageCategories(catPage + 1);"></td>
               		</tr>
               </table>
           </td>
           <td valign="top" align="left" width="20%" style="border:0px solid black; padding:2px">
               <strong>Menu Items</strong>
               <input type="hidden" id="itemId"/>
               <table id="menuItemTable" class="menuItemTable" width="100%">
               </table>
               <table width="100%">
               		<tr>
               			<td width="100%"><input type="button" class="smallbackbutton" onclick="pageItems(itemPage - 1);">
               			<input type="button" class="smallnextbutton" onclick="pageItems(itemPage + 1);"></td>
               		</tr>
               </table>
            </td>
            <td valign="top" align="left" width="22.5%" style="border:0px solid black; padding:2px">
               <strong>Global Options</strong>
               <table id="globalOptionsTable" class="optionsTable" width="100%">
               </table>
               <table width="100%">
               		<tr>
               			<td width="100%"><input type="button" class="smallbackbutton" onclick="pageGlobalOptions(globalOptionPage - 1);">
               			<input type="button" class="smallnextbutton" onclick="pageGlobalOptions(globalOptionPage + 1);"></td>
               		</tr>
               </table>
               <strong>Category Options</strong>
               <table id="catOptionsTable" class="optionsTable" width="100%">
               </table>
               <table width="100%">
               		<tr>
               			<td width="100%"><input type="button" class="smallbackbutton" onclick="pageCatOptions(catOptionPage - 1);">
               			<input type="button" class="smallnextbutton" onclick="pageCatOptions(catOptionPage + 1);"></td>
               		</tr>
               </table>
            </td>
            <td width="36%" valign="top" align="left" style="border:0px solid black">
               <form name="orderForm">
               	<input type="hidden" name="orderId"/>
               	<input type="hidden" name="orderType"/>
               	<input type="hidden" name="totalTax"/>
               	<input type="hidden" name="totalPrice"/>
               	<table width="100%">
               		<tr>
               			<th width="100%" valign="center" align="center" id="orderHeader">Order</th>
                	</tr>
               	</table>
               <table width="100%" border="0" id="orderTable" class="orderTable">
                  <tr>
                     <th width="60%" valign="top" align="left"><strong>Items</strong></th>
                     <th width="5%" valign="top" align="right"><strong>Quantity</strong></th>
                     <th width="15%" valign="top" align="right"><strong>Price</strong></th>
                  </tr>
                  <tr><td colspan="3"><br></td></tr>
                  <tr>
                     <td colspan="2" valign="top" align="right"><strong>Tax:</strong> </td>
                     <td valign="top" align="right"><strong></strong></td>
                  </tr>
                  <tr>
                     <td colspan="2" valign="top" align="right"><strong>Total:</strong> </td>
                     <td valign="top" align="right"><strong></strong></td>
                  </tr>
               </table>
               </form>
               <table>
                   <tr>
                   		<td>Quantity:</td><td id="btmQty"></td>
                   		<td>
                   			<input type="button" name="btnPlus" value="" class="plusbutton" onclick="updateQuantity(1);"/>
                   			<input type="button" name="btnMinus" value="" class="minusbutton" onclick="updateQuantity(-1);"/>
                   		</td>
                   </tr>
                   <tr>
                   		<td colspan="2">
                   			<input type="button" name="btnSave" value="Save Order" class="groovybutton" onclick="saveOrder();"/>
                   			<input type="button" name="btnDelete" value="Void Order" class="groovybutton" onclick="deleteOrder();"/>
                   			<input type="button" name="btnPay" value="Pay" class="groovybutton" onclick="showPayment();"/>
                   		</td>
                   </tr>
               </table>
            </td>
         </tr>
      </table>
   </div>
   
   <div id="modal" style="width:450px; height: 400px; border:2px solid #CC6600; background-color:white; padding:5px; font-size:100%; display:none;">
	<table border="0" width="100%">
		<form name="menuItemForm" id="menuItemForm">
			<input type="hidden" name="menuItemId" value=""/>
			<input type="hidden" name="itemName" value=""/>
			<input type="hidden" name="itemPrice" value=""/>
			<input type="hidden" name="optionsSize" value=""/>
		<tr>
			<td align="left" valign="top" id="menuItemName" name="menuItemName"></td>
		</tr>
		<tr>
			<td align="left" valign="top" id="menuItemDesc" name="menuItemDesc"></td>
		</tr>
		<tr id="singlePrice">
			<td align="left" id="menuItemPrice" name="menuItemPrice"></td>
		</tr>
		<tr>
			<td align="left">Quantity:<select id="menuItemQuantity" name="menuItemQuantity">
					<option value=1>1</option>
					<option value=2>2</option>
					<option value=3>3</option>
					<option value=4>4</option>
					<option value=5>5</option>
				</select>
			</td>
		</tr>
		<tr>
			<td align="left" valign="top">
				<table id="itemSizes" width="100%" style="display: block">
					<tr>
						<td width="33.3%"><input type="button" name="btnItemSmall" value="" class="groovybutton" onclick=""/></td>
						<td width="33.3%"><input type="button" name="btnItemMed"  value="" class="groovybutton" onclick=""/></td>
						<td width="33.3%"><input type="button" name="btnItemLarge" value="" class="groovybutton" onclick=""/></td>
					</tr>
				</table>
			</td>
		</tr>
		<tr id="itemOptionsRow" style="display: none">
			<td><strong>Item Options</strong>
	           	<table id="itemOptionsTable" class="optionsTable" width="100%">
	           	</table>
           	</td>
		</tr>
		
		<tr><td >&nbsp;</td></tr>
		<tr id="confirmRow">
			<td align="center">
				<input type="button" name="btnItemAdd" class="cancelbutton" onclick="" value="ADD"></input>
				<input type="button" class="cancelbutton" onclick="Popup.hide('modal')" value="CANCEL"></input>
			</td>
		</tr>
		</form>
	</table>
  </div>
	<div id="payment" style="width:650px; height: 400px; border:2px solid #CC6600; background-color:white; padding:2px; font-size:100%; display:none;">
		<table width="100%">
			<tr>
				<td width="100%" align="left">
					<table border="0" width="100%">
						<tr>
							<td width="20%"><strong>Payment Options:</strong></td>
							<td>
								<input type="button" name="btnCash" value="Cash" class="paymentbutton" onclick=""/>
								<input type="button" name="btnCredit" value="Credit Card" class="creditbutton" onclick=""/>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td width="100%">
					<div style="float:left">
						<table style="border:0px" width="100%">
						<form name="payForm">
							<tr>
								<td align="left"><strong>Sale Amount:</strong></td>
								<td align="left"><input type="text" id="saleAmt" name="saleAmt" style="font-size:14px;font-weight:bold"/></td>
							</tr>
							<tr>
								<td align="left"><strong>Tax:</strong></td>
								<td align="left"><input type="text" id="taxAmt" name="taxAmt" style="font-size:14px;font-weight:bold" onfocus="changeBackground(this)" onkeyup="updateAmt()"/></td>
							</tr>
							<tr>
								<td align="left"><strong>Tips:</strong></td>
								<td align="left"><input type="text" id="tipsAmt" name="tipsAmt" style="font-size: 14px;font-weight:bold" onfocus="changeBackground(this)" onkeyup="updateAmt()"/></td>
							</tr>
							<tr>
								<td align="left"><strong>Due Amount:</strong></td>
								<td align="left"><input type="text" id="dueAmt" name="dueAmt" style="font-size: 14px;font-weight:bold" onfocus="changeBackground(this)"/></td>
							</tr>
							<tr>
								<td align="left"><strong>Pay Amount:</strong></td>
								<td align="left"><input type="text" id="payAmt" name="payAmt" style="font-size: 14px;font-weight:bold" onfocus="changeBackground(this)" onkeyup="updateAmt()"/></td>
							</tr>
							<tr>
								<td colspan="2"><hr></td>
							</tr>
							<tr>
								<td align="left"><strong>Change:</strong></td>
								<td align="left"><input type="text" id="changeAmt" name="changeAmt" style="font-size: 14px;font-weight:bold" onfocus="changeBackground(this)"/></td>
							</tr>
						</form>
						</table>
					</div>
					<div style="float:left; width:20px">&nbsp;</div>
					<div style="float:left">
						<table width="100%">
							<tr>
								<td width="33.3%"><input type="button" name="btnSeven" value="7" class="numberbutton" onclick="addValue('7')"/></td>
								<td width="33.3%"><input type="button" name="btnEight" value="8" class="numberbutton" onclick="addValue('8')"/></td>
								<td width="33.3%"><input type="button" name="btnNine" value="9" class="numberbutton" onclick="addValue('9')"/></td>
							</tr>
							<tr>
								<td width="33.3%"><input type="button" name="btnFour" value="4" class="numberbutton" onclick="addValue('4')"/></td>
								<td width="33.3%"><input type="button" name="btnFive" value="5" class="numberbutton" onclick="addValue('5')"/></td>
								<td width="33.3%"><input type="button" name="btnSix" value="6" class="numberbutton" onclick="addValue('6')"/></td>
							</tr>
							<tr>
								<td width="33.3%"><input type="button" name="btnOne" value="1" class="numberbutton" onclick="addValue('1')"/></td>
								<td width="33.3%"><input type="button" name="btnTwo" value="2" class="numberbutton" onclick="addValue('2')"/></td>
								<td width="33.3%"><input type="button" name="btnThree" value="3" class="numberbutton" onclick="addValue('3')"/></td>
							</tr>
							<tr>
								<td><input type="button" name="btnZero" value="0" class="numberbutton" onclick="addValue('0')"/></td>
								<td><input type="button" name="btnDot" value="0" class="numberbutton" onclick="addValue('.')"/></td>
								<td align="center"><input type="button" name="btnClear" value="Clear" class="clearbutton" onclick="setValue('0')"/></td>
							</tr>
						</table>
					</div>
					<div style="float:left">
						<table width="100%">
							<tr>
								<td><input type="button" name="btnFiveDlr" value="$5" class="dollarbutton" onclick="setValue(5)"/></td>
								<td><input type="button" name="btnHundredDlr" value="$100" class="dollarbutton" onclick="setValue(100)"/></td>
							</tr>
							<tr>
								<td><input type="button" name="btnTenDlr" value="$10" class="dollarbutton" onclick="setValue(10)"/></td>
							</tr>
							<tr>
								<td><input type="button" name="btnTwentyDlr" value="$20" class="dollarbutton" onclick="setValue(20)"/></td>
							</tr>
							<tr>
								<td><input type="button" name="btnFiftyDlr" value="$50" class="dollarbutton" onclick="setValue(50)"/></td>
							</tr>
						</table>
					</div>
				</td>
			</tr>
			<tr><td><hr></td></tr>
			<tr>
				<td align="center" width="100%">
					<table width="100%">
						<tr>
							<td align="center" width="100%">
								<input type="button" name="btnSettle" value="Settle Payment" class="settlebutton" onclick="calcChange()"/>
								<input type="button" name="btnClose" value="Close" class="settlebutton" onclick="Popup.hide('payment')"/>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
	</div>
</body>
</html>
